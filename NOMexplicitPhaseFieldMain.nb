(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    335274,       8613]
NotebookOptionsPosition[    331297,       8556]
NotebookOutlinePosition[    331640,       8571]
CellTagsIndexPosition[    331597,       8568]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["NOM with explicit phase field for dynamic brittle fracture", "Chapter",
 CellChangeTimes->{{3.837398284309955*^9, 
  3.8373983127184725`*^9}},ExpressionUUID->"83a0cf8f-d3ae-44c8-b40c-\
63f4dc270e55"],

Cell["\<\
Reference: 
Nonlocal operator method for dynamic brittle fracture based on an explicit \
phase field model
https://doi.org/10.1016/j.euromechsol.2021.104380 \
\>", "Text",
 CellChangeTimes->{{3.8373984696351395`*^9, 3.83739852576171*^9}, {
  3.8373985979490585`*^9, 
  3.8373986383394275`*^9}},ExpressionUUID->"40603b02-9f00-4e1a-b342-\
3924dd25f3f7"],

Cell["\<\
This notebook contains the main functions for nonlocal operator method with \
an explicit phase field scheme for dynamic brittle fractures. 
It is based on Miehe\[CloseCurlyQuote]s phase field model with eigenvalue \
decomposition of the strain tensor.
It can deal with both 2D and 3D linear elasticity problem. 
\
\>", "Text",
 CellChangeTimes->{{3.8373979380142775`*^9, 3.8373981611215887`*^9}, {
  3.8373982329329667`*^9, 3.837398237791959*^9}, {3.8373986594499454`*^9, 
  3.837398666734521*^9}, {3.8374869858407097`*^9, 
  3.8374869877792645`*^9}},ExpressionUUID->"73195803-8268-43f2-a405-\
969ddc712ef7"],

Cell[CellGroupData[{

Cell["Functions for pre-post process", "Section",
 CellChangeTimes->{{3.777555284606563*^9, 3.7775553132262*^9}, 
   3.777555772111447*^9, {3.837397921320448*^9, 
   3.837397922488964*^9}},ExpressionUUID->"aeaffa70-f8d8-408f-8d39-\
8d415fe69e29"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OvitoOutput4", "[", 
    RowBox[{
    "path_String", ",", "fname_String", ",", "istep_", ",", "tag_", ",", 
     "x__"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", "str", ",", "xd0", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}], ",", "nx", ",", "xil", ",", "xil2", ",", 
       "xd2", ",", "len", ",", "num", ",", "al", ",", "als", ",", "strl0", 
       ",", "strl", ",", "colsep", ",", "rowsep", ",", "prec", ",", 
       "doubletostring"}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.txt\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"xd", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nx", "=", 
       RowBox[{"Length", "[", "xd", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"StringSplit", "[", 
             RowBox[{"tag", ",", 
              RowBox[{"{", 
               RowBox[{"\"\< \>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}], ",", 
            "\"\<\>\""}], "]"}], "]"}], "\[NotEqual]", "len"}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error, the tags are not consistent with the data, no data \
written\>\"", "]"}], ";", 
         RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"xd0", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"num", ",", 
           RowBox[{"len", "+", "2"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{"xd0", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], "=", 
       RowBox[{"N", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "num"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xil2", "=", "2"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xil", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"xd", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"xd0", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{"xil2", "+", "1"}], ";;", 
              RowBox[{"xil2", "+", "xil"}]}]}], "]"}], "]"}], "=", 
          RowBox[{"xd", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"xil2", "+=", "xil"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "nx"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"colsep", "=", "\"\<\\t\>\""}], ";", 
      RowBox[{"rowsep", "=", "\"\<\\n\>\""}], ";", 
      RowBox[{"prec", "=", "6"}], ";", 
      RowBox[{"SetAttributes", "[", 
       RowBox[{"doubletostring", ",", "Listable"}], "]"}], ";", 
      RowBox[{
       RowBox[{"doubletostring", "[", "xxx_", "]"}], ":=", 
       RowBox[{"Internal`DoubleToString", "[", 
        RowBox[{"xxx", ",", "False", ",", "prec"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"strl", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Riffle", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<ITEM: TIMESTEP\>\"", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", 
            "\"\<ITEM: NUMBER OF ATOMS\>\"", ",", 
            RowBox[{"ToString", "[", "num", "]"}], ",", 
            RowBox[{"\"\<ITEM: ATOMS id type \>\"", "<>", "tag"}]}], "}"}], 
          ",", "rowsep"}], "]"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
       "parallel", " ", "table", " ", "is", " ", "not", " ", "faster", " ", 
        "than", " ", "table"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"strl0", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"len", " ", "num"}], "<", "1000000"}], ",", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{"row", "\[Function]", 
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"StringJoin", "[", 
                RowBox[{
                 RowBox[{"Riffle", "[", 
                  RowBox[{
                   RowBox[{"doubletostring", "/@", "row"}], ",", "colsep"}], 
                  "]"}], ",", "rowsep"}], "]"}], ",", 
               RowBox[{"\"\<*^\>\"", "\[Rule]", "\"\<e\>\""}]}], "]"}]}], ",",
             "xd0"}], "]"}], "]"}], ",", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"ParallelMap", "[", 
           RowBox[{
            RowBox[{"row", "\[Function]", 
             RowBox[{"StringReplace", "[", 
              RowBox[{
               RowBox[{"StringJoin", "[", 
                RowBox[{
                 RowBox[{"Riffle", "[", 
                  RowBox[{
                   RowBox[{"doubletostring", "@", "row"}], ",", "colsep"}], 
                  "]"}], ",", "rowsep"}], "]"}], ",", 
               RowBox[{"\"\<*^\>\"", "\[Rule]", "\"\<e\>\""}]}], "]"}]}], ",",
             "xd0"}], "]"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"file", ",", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"strl", ",", "rowsep", ",", "strl0"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.778461721999696*^9, {3.778461851013075*^9, 3.778462065846363*^9}, 
   3.778462108236788*^9, {3.7784623545078735`*^9, 3.7784623736319675`*^9}, {
   3.778462410599082*^9, 3.77846244221889*^9}, {3.7784625020273113`*^9, 
   3.7784625037794113`*^9}, {3.7784627325194945`*^9, 3.7784627346836185`*^9}, 
   3.780396951639908*^9, 3.780411163705771*^9, {3.780828332288247*^9, 
   3.7808283324844913`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"ac190018-15b7-4e96-bd1f-1893f94cfc89"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DoubleListToString", "[", 
     RowBox[{"a_List", ",", 
      RowBox[{"ndigit_:", "5"}]}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"as", "=", "\"\<\>\""}], "}"}], ",", 
      RowBox[{
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"as", "=", 
           RowBox[{"StringJoin", "[", 
            RowBox[{"as", ",", "\"\< \>\"", ",", 
             RowBox[{"Internal`DoubleToString", "[", 
              RowBox[{
               RowBox[{"a", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "False", ",", "ndigit"}],
               "]"}]}], "]"}]}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"as", ",", 
         RowBox[{"\"\<*^\>\"", "\[Rule]", "\"\<e\>\""}]}], "]"}]}]}], "]"}]}],
    ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"tag", " ", "is", " ", "the", " ", "name", " ", "in", " ", "x__"}],
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OvitoOutput", "[", 
    RowBox[{
    "path_String", ",", "fname_String", ",", "istep_", ",", "tag_", ",", 
     "x__"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", "str", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}], ",", "len", ",", "num", ",", "al", ",", 
       "als", ",", "strl0", ",", "strl"}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.txt\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"xd", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"StringSplit", "[", 
               RowBox[{"tag", ",", 
                RowBox[{"{", 
                 RowBox[{"\"\< \>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}], 
              ",", "\"\<\>\""}], "]"}], "]"}], "\[NotEqual]", "len"}], ",", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Error, the tags are not consistent with the data, no data \
written\>\"", "]"}], ";", 
           RowBox[{"Return", "[", "]"}]}]}], "]"}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xd", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"strl", "=", 
       RowBox[{"{", 
        RowBox[{"\"\<ITEM: TIMESTEP\>\"", ",", 
         RowBox[{"ToString", "[", "istep", "]"}], ",", 
         "\"\<ITEM: NUMBER OF ATOMS\>\"", ",", 
         RowBox[{"ToString", "[", "num", "]"}], ",", 
         RowBox[{"\"\<ITEM: ATOMS id type \>\"", "<>", "tag"}]}], "}"}]}], 
      ";", 
      RowBox[{"(*", 
       RowBox[{
       "table", " ", "seems", " ", "to", " ", "be", " ", "the", " ", "best"}],
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{"strl0", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\< 1 \>\"", "<>", 
          RowBox[{"DoubleListToString", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"xd", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "i"}], "]"}], "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "num"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"file", ",", 
        RowBox[{"Join", "[", 
         RowBox[{"strl", ",", "strl0"}], "]"}], ",", "\"\<Text\>\""}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CreateFolder", "[", "mydir_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"sn", "=", 
        RowBox[{"NotebookDirectory", "[", "]"}]}], ",", "dirname"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"dirname", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"sn", ",", "mydir"}], "}"}], "]"}]}], ";", 
      RowBox[{"Switch", "[", 
       RowBox[{
        RowBox[{"FileType", "[", "dirname", "]"}], ",", "None", ",", 
        RowBox[{"CreateDirectory", "[", "dirname", "]"}], " ", 
        RowBox[{"(*", 
         RowBox[{"create", " ", "dir"}], "*)"}], ",", "Directory", ",", 
        "Null", " ", 
        RowBox[{"(*", 
         RowBox[{"do", " ", "nothing"}], "*)"}], ",", "File", ",", 
        RowBox[{
        "Print", "[", "\"\<File with same name already exists!!\>\"", "]"}]}],
        " ", 
       RowBox[{"(*", 
        RowBox[{"error", "!"}], "*)"}], "]"}], ";", 
      RowBox[{"dirname", "<>", 
       RowBox[{"StringTake", "[", 
        RowBox[{"sn", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "]"}]}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MMsave", "[", 
    RowBox[{"path_String", ",", "fname_String", ",", "istep_", ",", "x__"}], 
    "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"file", ",", 
       RowBox[{"xd", "=", 
        RowBox[{"{", "x", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.wdx\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"file", ",", "xd"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Output: \>\"", ",", "file"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MMread", "[", 
    RowBox[{"path_String", ",", "fname_String", ",", "istep_"}], "]"}], ":=", 
   
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "file", "}"}], ",", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"path", ",", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"fname", ",", 
            RowBox[{"ToString", "[", "istep", "]"}], ",", "\"\<.wdx\>\""}], 
           "]"}]}], "}"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"str", "=", 
         RowBox[{"OpenWrite", "[", "file", "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Import", "[", "file", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.778422782639086*^9, 3.7784227999320745`*^9}, {
   3.7784246286086693`*^9, 3.778424670422061*^9}, {3.778424876094825*^9, 
   3.7784248772928934`*^9}, {3.778425754002038*^9, 3.778425868917611*^9}, {
   3.7784259072308025`*^9, 3.778425922316665*^9}, {3.778425960003821*^9, 
   3.778425963627028*^9}, {3.7784261038710494`*^9, 3.778426117467827*^9}, {
   3.778427047203005*^9, 3.7784270478220406`*^9}, {3.7784270897114363`*^9, 
   3.778427116250954*^9}, {3.7784272503166227`*^9, 3.778427316386401*^9}, 
   3.7784274473228903`*^9, 3.778427691229841*^9, {3.7784277680222335`*^9, 
   3.778427796378855*^9}, {3.77842822987265*^9, 3.778428248630723*^9}, {
   3.778428376026009*^9, 3.7784283811853046`*^9}, {3.7784284956698523`*^9, 
   3.7784284961058774`*^9}, 3.778428618665888*^9, 3.7784286566870623`*^9, {
   3.778428794982972*^9, 3.778428902614128*^9}, 3.778429027068247*^9, 
   3.778461274602106*^9, {3.7784632482599936`*^9, 3.7784632666910477`*^9}, 
   3.7809899939665117`*^9, {3.8374824820198746`*^9, 3.837482504505699*^9}, {
   3.8374825502070875`*^9, 3.837482553528819*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"dc997cd0-cad7-4b32-ae2f-d1b48b8402d7"],

Cell[BoxData[{
 RowBox[{"Needs", "[", "\"\<NDSolve`FEM`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDelaunayMesh", "[", "coord_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mm", ",", "mm2", ",", "ndim"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ndim", "<", "2"}], " ", "||", " ", 
         RowBox[{"ndim", ">", "3"}]}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error, delaunayMesh only applies for 2D and 3D\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mm", "=", 
       RowBox[{"DelaunayMesh", "[", "coord", "]"}]}], ";", 
      RowBox[{"mm2", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[Equal]", "2"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "2"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Polygon", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "3"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Tetrahedron", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], 
           ",", 
           RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], ";", 
      RowBox[{"Abaqus2Mesh", "[", 
       RowBox[{"coord", ",", "mm2"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDelaunayMesh", "[", 
    RowBox[{"coord_", ",", "uvw_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mm", ",", "mm2", ",", "ndim"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"mm", "=", 
       RowBox[{"DelaunayMesh", "[", "coord", "]"}]}], ";", 
      RowBox[{"mm2", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[Equal]", "2"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "2"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Polygon", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], ",", 
           RowBox[{"-", "1"}]}], "]"}], ",", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"MeshCells", "[", 
            RowBox[{"mm", ",", "3"}], "]"}], ",", 
           RowBox[{
            RowBox[{"Tetrahedron", "[", "x_", "]"}], "\[RuleDelayed]", "x"}], 
           ",", 
           RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], ";", 
      RowBox[{"Abaqus2Mesh", "[", 
       RowBox[{
        RowBox[{"coord", "+", "uvw"}], ",", "mm2"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Abaqus2Mesh", "[", 
    RowBox[{"coord_", ",", "mesh_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ec", ",", 
       RowBox[{"el", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"ec", "=", 
       RowBox[{"ElementClassify", "[", 
        RowBox[{"mesh", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"coord", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"ec", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"el", ",", 
          RowBox[{"TriangleElement", "[", 
           RowBox[{"mesh", "[", 
            RowBox[{"[", 
             RowBox[{"ec", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"ec", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"el", ",", 
          RowBox[{"QuadElement", "[", 
           RowBox[{"mesh", "[", 
            RowBox[{"[", 
             RowBox[{"ec", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"ec", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"el", ",", 
          RowBox[{"TetrahedronElement", "[", 
           RowBox[{"mesh", "[", 
            RowBox[{"[", 
             RowBox[{"ec", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"ec", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "]"}], ">", "0"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"el", ",", 
          RowBox[{"HexahedronElement", "[", 
           RowBox[{"mesh", "[", 
            RowBox[{"[", 
             RowBox[{"ec", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ToElementMesh", "[", 
       RowBox[{
        RowBox[{"\"\<Coordinates\>\"", "\[Rule]", "coord"}], ",", 
        RowBox[{"\"\<MeshElements\>\"", "\[Rule]", "el"}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ElementClassifyEc", "[", 
    RowBox[{"len_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"n", "\[Equal]", "2"}], ",", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"len", "\[Equal]", "3"}], " ", "||", " ", 
        RowBox[{"len", "\[Equal]", "6"}]}], ",", "1", ",", "2"}], "]"}], ",", 
     
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"len", "\[Equal]", "4"}], "||", 
        RowBox[{"len", "\[Equal]", "10"}]}], ",", "3", ",", "4"}], "]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ElementClassify", "[", 
     RowBox[{"mesh_", ",", "ndim_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pos", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"Length", "[", "mesh", "]"}]}], "]"}]}], ",", 
        RowBox[{"toqh", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}]}], "}"}]}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"pos", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"ElementClassifyEc", "[", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"mesh", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "ndim"}], "]"}]}], 
          ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "mesh", "]"}]}], "}"}]}], "]"}], ";", 
       RowBox[{
        RowBox[{"toqh", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"pos", ",", "1"}], "]"}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"toqh", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"pos", ",", "2"}], "]"}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"toqh", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"pos", ",", "3"}], "]"}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"toqh", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"pos", ",", "4"}], "]"}], "]"}]}], ";", "toqh"}]}], "]"}]}],
    ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"2", "D", " ", "field", " ", "plot", " ", "functions"}], ";"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Plot2DField", "[", 
     RowBox[{"vals_List", ",", "mesh_ElementMesh"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"vi", ",", "vm", ",", 
        RowBox[{"color", "=", "\"\<Rainbow\>\""}], ",", 
        RowBox[{"ntick", "=", "10"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"vm", ",", "vi"}], "}"}], "=", 
        RowBox[{"MinMax", "@", "vals"}]}], ";", 
       RowBox[{"Legended", "[", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{"ElementMeshToGraphicsComplex", "[", 
           RowBox[{"mesh", ",", 
            RowBox[{"VertexColors", "\[Rule]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ColorData", "[", "color", "]"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1.0", "/", 
                   RowBox[{"(", 
                    RowBox[{"vi", "-", "vm", "+", 
                    RowBox[{"10.", "^", 
                    RowBox[{"-", "20"}]}]}], ")"}]}], ")"}], 
                 RowBox[{"(", 
                  RowBox[{"vals", "-", "vm"}], ")"}]}], ")"}]}], ")"}]}]}], 
           "]"}], "]"}], ",", 
         RowBox[{"BarLegend", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"color", ",", 
             RowBox[{"{", 
              RowBox[{"vm", ",", "vi"}], "}"}]}], "}"}], ",", "ntick"}], 
          "]"}]}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Plot2DField", "[", 
      RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "uvw_List", ",", 
       RowBox[{"color_:", "\"\<Rainbow\>\""}], ",", 
       RowBox[{"ntick_:", "10"}]}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "m2", "}"}], ",", 
       RowBox[{
        RowBox[{"m2", "=", 
         RowBox[{"ToElementMesh", "[", 
          RowBox[{
           RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"mesh", "[", "\"\<Coordinates\>\"", "]"}], "+", "uvw"}],
              ")"}]}], ",", 
           RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"mesh", "[", "\"\<MeshElements\>\"", "]"}], ")"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Plot2DField", "[", 
         RowBox[{"vals", ",", "m2", ",", "color", ",", "ntick"}], "]"}]}]}], 
      "]"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "uvw_List"}], "]"}], ":=", 
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals", ",", 
     RowBox[{"DeformMesh", "[", 
      RowBox[{"mesh", ",", "uvw"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeformMesh", "[", 
    RowBox[{"mesh_ElementMesh", ",", "uvw_List"}], "]"}], ":=", 
   RowBox[{"ToElementMesh", "[", 
    RowBox[{
     RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"mesh", "[", "\"\<Coordinates\>\"", "]"}], "+", "uvw"}], 
       ")"}]}], ",", 
     RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"mesh", "[", "\"\<MeshElements\>\"", "]"}], ")"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot2DField", "[", 
    RowBox[{"vals_List", ",", "mesh_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"Plot2DField", "[", 
      RowBox[{"vals", ",", 
       RowBox[{"MyDelaunayMesh", "[", "mesh", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Plot2DField", "[", 
     RowBox[{"vals_List", ",", "mesh_List", ",", "uvw_List"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", 
      RowBox[{"Plot2DField", "[", 
       RowBox[{"vals", ",", 
        RowBox[{"MyDelaunayMesh", "[", 
         RowBox[{"mesh", ",", "uvw"}], "]"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"3", "D", " ", "field", " ", "plot", " ", "functions"}], ";"}], 
   "*)"}]}], "\n", 
 RowBox[{"Needs", "[", "\"\<NDSolve`FEM`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot3DField", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", 
     RowBox[{"ndim_:", "3"}], ",", 
     RowBox[{"nnode_:", "1"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "len", "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[NotEqual]", "3"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<Plot3DField Error, only for 3D mesh\>\"", "]"}], 
          ";", 
          RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vals", "]"}], "\[NotEqual]", "nnode"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Plot3DField Error, the number of nodes is not the same as the \
length of vals\>\"", "]"}], ";", 
          RowBox[{"Return", "[", "]"}]}]}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Legended", "[", 
      RowBox[{
       RowBox[{"ElementMeshSurfacePlot3D", "[", 
        RowBox[{"vals", ",", "mesh", ",", 
         RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"AxesLabel", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], "]"}], ",", 
       RowBox[{"BarLegend", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ColorFunction", "/.", 
            RowBox[{"Options", "[", "ElementMeshSurfacePlot3D", "]"}]}], "//",
            "First"}], ",", 
          RowBox[{"MinMax", "@", "vals"}]}], "}"}], "]"}]}], "]"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot3DField", "[", 
    RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "title_String"}], 
    "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "len", "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ndim", "\[NotEqual]", "3"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<Plot3DField Error, only for 3D mesh\>\"", "]"}], 
          ";", 
          RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "vals", "]"}], "\[NotEqual]", "nnode"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Plot3DField Error, the number of nodes is not the same as the \
length of vals\>\"", "]"}], ";", 
          RowBox[{"Return", "[", "]"}]}]}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Legended", "[", 
      RowBox[{
       RowBox[{"ElementMeshSurfacePlot3D", "[", 
        RowBox[{"vals", ",", "mesh", ",", 
         RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"AxesLabel", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", "title"}]}], "]"}], ",", 
       RowBox[{"BarLegend", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ColorFunction", "/.", 
            RowBox[{"Options", "[", "ElementMeshSurfacePlot3D", "]"}]}], "//",
            "First"}], ",", 
          RowBox[{"MinMax", "@", "vals"}]}], "}"}], "]"}]}], "]"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Plot3DField", "[", 
     RowBox[{"vals_List", ",", "mesh_ElementMesh", ",", "uvw_List", ",", 
      RowBox[{"color_:", "\"\<Rainbow\>\""}], ",", 
      RowBox[{"ntick_:", "10"}]}], "]"}], ":=", 
    RowBox[{"Plot3DField", "[", 
     RowBox[{"vals", ",", 
      RowBox[{"DeformMesh", "[", 
       RowBox[{"mesh", ",", "uvw"}], "]"}], ",", "3", ",", 
      RowBox[{"Length", "[", "vals", "]"}]}], "]"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "m2", "}"}], ",", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"m2", "=", 
         RowBox[{"ToElementMesh", "[", 
          RowBox[{
           RowBox[{"\"\<Coordinates\>\"", "\[Rule]", 
            RowBox[{
             RowBox[{"mesh", "[", "\"\<Coordinates\>\"", "]"}], "+", 
             "uvw"}]}], ",", 
           RowBox[{"\"\<MeshElements\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"mesh", "[", "\"\<MeshElements\>\"", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}]}]}], "]"}]}], ";"}], 
       "*)"}], 
      RowBox[{"Plot3DField", "[", 
       RowBox[{"vals", ",", 
        RowBox[{"DeformMesh", "[", 
         RowBox[{"mesh", ",", "uvw"}], "]"}], ",", "3", ",", 
        RowBox[{"Length", "[", "vals", "]"}]}], "]"}]}], "]"}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot3DField", "[", 
    RowBox[{"vals_List", ",", "mesh_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"Plot3DField", "[", 
      RowBox[{"vals", ",", 
       RowBox[{"MyDelaunayMesh", "[", "mesh", "]"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{"mesh", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
       RowBox[{"Length", "[", "mesh", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Plot3DField", "[", 
    RowBox[{"vals_List", ",", "mesh_List", ",", "uvw_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"Plot3DField", "[", 
      RowBox[{"vals", ",", 
       RowBox[{"MyDelaunayMesh", "[", 
        RowBox[{"mesh", ",", "uvw"}], "]"}], ",", 
       RowBox[{"Length", "[", 
        RowBox[{"mesh", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
       RowBox[{"Length", "[", "mesh", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ParseAbaqusFile", "::", "usage"}], "=", 
    "\"\<{nodes,elements,sets}=ParseAbaqusFile[FilePath];it can read \
keywords: *node, *element, *set. Before processing the file, please convert \
the *elset to *set and *nset to *set in the input file\>\""}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"ParseAbaqusFile", "[", "file_String", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "i", ",", "j", ",", "k", ",", "node", ",", "element", ",", "setList", 
         ",", "oneSet", ",", "starList", ",", "starLine", ",", "tlineStart", 
         ",", "tlineEnd", ",", "tline", ",", "strings", ",", "String2List", 
         ",", " ", "i1", ",", "i2", ",", "len", ",", "pair", ",", "ei", ",", 
         "j1"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"FileExtension", "[", "file", "]"}], "\[NotEqual]", 
           "\"\<inp\>\""}], ",", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<Error,the file should be Abaqus keyword file .inp\>\"", 
            "]"}], ";", 
           RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"strings", "=", 
         RowBox[{"ReadList", "[", 
          RowBox[{"file", ",", "String"}], "]"}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"strings", "\[Equal]", "$Failed"}], ",", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<Error,file not found\>\"", "]"}], ";", 
           RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", 
        RowBox[{"i", "=", 
         RowBox[{
          RowBox[{"Dimensions", "[", "strings", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", 
        RowBox[{"node", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"element", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"setList", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"starList", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"StringStartsQ", "[", 
              RowBox[{
               RowBox[{"strings", "[", 
                RowBox[{"[", "j", "]"}], "]"}], ",", "\"\<*\>\""}], "]"}], "&&", 
             RowBox[{"!", 
              RowBox[{"StringStartsQ", "[", 
               RowBox[{
                RowBox[{"strings", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\"\<**\>\"", ",", "\"\<$\>\""}], "}"}]}], "]"}]}]}],
             ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"starList", ",", "j"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "i"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"String2List", "[", "str_String", "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"sl", ",", "s2"}], "}"}], ",", 
           RowBox[{
            RowBox[{"s2", "=", 
             RowBox[{"StringReplace", "[", 
              RowBox[{"str", ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"\"\<E\>\"", ",", "\"\<e\>\""}], "}"}], "\[Rule]", 
                "\"\<*^\>\""}]}], "]"}]}], ";", 
            RowBox[{"sl", "=", 
             RowBox[{"StringSplit", "[", 
              RowBox[{"s2", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<,\>\"", ",", "\"\< \>\""}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"ToExpression", "[", "sl", "]"}], ",", "Null"}], 
             "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"starLine", "=", 
            RowBox[{"ToLowerCase", "[", 
             RowBox[{"strings", "[", 
              RowBox[{"[", 
               RowBox[{"starList", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"tlineStart", "=", 
            RowBox[{
             RowBox[{"starList", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "+", "1"}]}], ";", 
           RowBox[{"tlineEnd", "=", 
            RowBox[{
             RowBox[{"starList", "[", 
              RowBox[{"[", 
               RowBox[{"j", "+", "1"}], "]"}], "]"}], "-", "1"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Which", "[", 
            RowBox[{
             RowBox[{"StringStartsQ", "[", 
              RowBox[{"starLine", ",", "\"\<*node\>\""}], "]"}], ",", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"tline", "=", 
                 RowBox[{"strings", "[", 
                  RowBox[{"[", "k", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"!", 
                   RowBox[{"StringStartsQ", "[", 
                    RowBox[{"tline", ",", "\"\<*\>\""}], "]"}]}], ",", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"node", ",", 
                    RowBox[{"String2List", "[", "tline", "]"}]}], "]"}]}], 
                 "]"}], ";"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "tlineStart", ",", "tlineEnd"}], "}"}]}], 
              "]"}], 
             RowBox[{"(*", "*)"}], ",", 
             RowBox[{"StringStartsQ", "[", 
              RowBox[{"starLine", ",", "\"\<*element\>\""}], "]"}], ",", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"tline", "=", 
                 RowBox[{"strings", "[", 
                  RowBox[{"[", "k", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"!", 
                   RowBox[{"StringStartsQ", "[", 
                    RowBox[{"tline", ",", "\"\<*\>\""}], "]"}]}], ",", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"element", ",", 
                    RowBox[{"String2List", "[", "tline", "]"}]}], "]"}]}], 
                 "]"}], ";"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "tlineStart", ",", "tlineEnd"}], "}"}]}], 
              "]"}], 
             RowBox[{"(*", "*)"}], ",", 
             RowBox[{"StringStartsQ", "[", 
              RowBox[{"starLine", ",", "\"\<*set\>\""}], "]"}], ",", 
             RowBox[{
              RowBox[{"oneSet", "=", 
               RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"tline", "=", 
                  RowBox[{"strings", "[", 
                   RowBox[{"[", "k", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"StringStartsQ", "[", 
                    RowBox[{"tline", ",", "\"\<*\>\""}], "]"}]}], ",", 
                   RowBox[{"AppendTo", "[", 
                    RowBox[{"oneSet", ",", 
                    RowBox[{"String2List", "[", "tline", "]"}]}], "]"}]}], 
                  "]"}], ";"}], ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "tlineStart", ",", "tlineEnd"}], "}"}]}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"setList", ",", 
                RowBox[{"Flatten", "[", "oneSet", "]"}]}], "]"}]}]}], 
            RowBox[{"(*", "*)"}], "]"}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{
             RowBox[{"Length", "[", "starList", "]"}], "-", "1"}]}], "}"}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"len", "=", 
         RowBox[{"Length", "[", "node", "]"}]}], ";", 
        RowBox[{"i1", "=", 
         RowBox[{"node", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
        RowBox[{"i2", "=", 
         RowBox[{"node", "[", 
          RowBox[{"[", 
           RowBox[{"len", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"i1", "\[Equal]", "1"}], " ", "&&", " ", 
           RowBox[{"i2", "\[Equal]", "len"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"node", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", 
                RowBox[{"2", ";;", 
                 RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", 
             RowBox[{"element", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", 
                RowBox[{"2", ";;", 
                 RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", "setList"}], 
            "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"pair", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", "i2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pair", "[", 
            RowBox[{"[", 
             RowBox[{"node", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "=", 
           "i"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"len", "=", 
         RowBox[{"Length", "[", "element", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ei", "=", 
            RowBox[{"element", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"j1", "=", 
               RowBox[{"ei", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], ";", 
              RowBox[{
               RowBox[{"ei", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "=", 
               RowBox[{"pair", "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], ";"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "2", ",", 
               RowBox[{"Length", "[", "ei", "]"}]}], "}"}]}], "]"}], ";", 
           RowBox[{
            RowBox[{"element", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", "ei"}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"node", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", 
          RowBox[{"element", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", "setList"}], 
         "}"}]}]}], "]"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ParseAbaqusFile", "[", "file_String", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "j", ",", "node", ",", "element", ",", "setList", ",", "oneSet", ",", 
        RowBox[{"starList", "=", 
         RowBox[{"{", "}"}]}], ",", "starLine", ",", "tlineStart", ",", 
        "tlineEnd", ",", "tline", ",", "strings", ",", "String2List", ",", 
        "i1", ",", "i2", ",", "len", ",", "pair", ",", "ei", ",", "j1", ",", 
        RowBox[{"nodeRange", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"eleRange", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"setRange", "=", 
         RowBox[{"{", "}"}]}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FileExtension", "[", "file", "]"}], "\[NotEqual]", 
          "\"\<inp\>\""}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Error,the file should be Abaqus keyword file .inp\>\"", "]"}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"strings", "=", 
        RowBox[{"ReadList", "[", 
         RowBox[{"file", ",", "String"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"strings", "\[Equal]", "$Failed"}], ",", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<Error,file not found\>\"", "]"}], ";", 
          RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"StringStartsQ", "[", 
            RowBox[{
             RowBox[{"strings", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", "\"\<*\>\""}], "]"}], ",", 
           
           RowBox[{"AppendTo", "[", 
            RowBox[{"starList", ",", "j"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"Length", "[", "strings", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"starList", ",", 
         RowBox[{"Length", "[", "strings", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"j", "=", 
           RowBox[{"starList", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", 
          RowBox[{"tline", "=", 
           RowBox[{"ToLowerCase", "[", 
            RowBox[{"strings", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"StringStartsQ", "[", 
             RowBox[{"tline", ",", "\"\<*node\>\""}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"nodeRange", ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"j", "+", "1"}], ",", 
                RowBox[{
                 RowBox[{"starList", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", "1"}]}], 
               "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"StringStartsQ", "[", 
             RowBox[{"tline", ",", "\"\<*element\>\""}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"eleRange", ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"j", "+", "1"}], ",", 
                RowBox[{
                 RowBox[{"starList", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", "1"}]}], 
               "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"StringStartsQ", "[", 
             RowBox[{"tline", ",", "\"\<*set\>\""}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"setRange", ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"j", "+", "1"}], ",", 
                RowBox[{
                 RowBox[{"starList", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", "1"}]}], 
               "]"}]}], "]"}]}], "]"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{
            RowBox[{"Length", "[", "starList", "]"}], "-", "1"}]}], "}"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"nodeRange", "=", 
        RowBox[{"Flatten", "[", "nodeRange", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"setRange", "=", 
        RowBox[{"Flatten", "[", "setRange", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"eleRange", "=", 
        RowBox[{"Flatten", "[", "eleRange", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"String2List", "[", "str_String", "]"}], ":=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"sl", ",", "s2"}], "}"}], ",", 
          RowBox[{
           RowBox[{"s2", "=", 
            RowBox[{"StringReplace", "[", 
             RowBox[{"str", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\"\<E\>\"", ",", "\"\<e\>\""}], "}"}], "\[Rule]", 
               "\"\<*^\>\""}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"sl", "=", 
            RowBox[{"StringSplit", "[", 
             RowBox[{"s2", ",", 
              RowBox[{"{", 
               RowBox[{"\"\<,\>\"", ",", "\"\< \>\""}], "}"}]}], "]"}]}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{
             RowBox[{"ToExpression", "[", "sl", "]"}], ",", "Null"}], 
            "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"SetAttributes", "[", 
        RowBox[{"String2List", ",", "Listable"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"node", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "nodeRange", "]"}], "<", "100000"}], ",", 
          RowBox[{"String2List", "[", 
           RowBox[{"strings", "[", 
            RowBox[{"[", "nodeRange", "]"}], "]"}], "]"}], ",", 
          RowBox[{"ParallelTable", "[", 
           RowBox[{
            RowBox[{"String2List", "[", 
             RowBox[{"strings", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "nodeRange"}], "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"element", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "eleRange", "]"}], "<", "100000"}], ",", 
          RowBox[{"String2List", "[", 
           RowBox[{"strings", "[", 
            RowBox[{"[", "eleRange", "]"}], "]"}], "]"}], ",", 
          RowBox[{"ParallelTable", "[", 
           RowBox[{
            RowBox[{"String2List", "[", 
             RowBox[{"strings", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "eleRange"}], "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"setList", "=", 
        RowBox[{"String2List", "[", 
         RowBox[{"strings", "[", 
          RowBox[{"[", "setRange", "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "node", "]"}]}], ";", 
       RowBox[{"i1", "=", 
        RowBox[{"node", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
       RowBox[{"i2", "=", 
        RowBox[{"node", "[", 
         RowBox[{"[", 
          RowBox[{"len", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"i1", "\[Equal]", "1"}], "&&", 
          RowBox[{"i2", "\[Equal]", "len"}]}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"node", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"2", ";;", 
                RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", 
            RowBox[{"element", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"2", ";;", 
                RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", "setList"}], "}"}],
           "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"pair", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "i2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pair", "[", 
           RowBox[{"[", 
            RowBox[{"node", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "=", "i"}],
          ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "element", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ei", "=", 
           RowBox[{"element", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"j1", "=", 
              RowBox[{"ei", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";", 
             RowBox[{
              RowBox[{"ei", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"pair", "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2", ",", 
              RowBox[{"Length", "[", "ei", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"element", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", "ei"}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"node", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", 
         RowBox[{"element", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"2", ";;", 
             RowBox[{"-", "1"}]}]}], "]"}], "]"}], ",", "setList"}], 
        "}"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AreaOf2DElement", "[", 
    RowBox[{"nodes_List", ",", "elements_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ndim", ",", "nnode", ",", "ve"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"nodes", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"nnode", "=", 
       RowBox[{"Length", "[", "elements", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "2"}], ",", 
        RowBox[{"ve", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Area", "[", 
            RowBox[{"Polygon", "[", 
             RowBox[{"nodes", "[", 
              RowBox[{"[", 
               RowBox[{"elements", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "nnode"}], "}"}]}], "]"}]}], ",", 
        RowBox[{
        "Print", "[", "\"\<Error, only 2D elements are allowed\>\"", "]"}]}], 
       "]"}], ";", "ve"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Area2Nodes", "[", 
    RowBox[{"nodes_List", ",", "elements_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ve", ",", "ne", ",", "ei"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ve", "=", 
       RowBox[{"AreaOf2DElement", "[", 
        RowBox[{"nodes", ",", "elements"}], "]"}]}], ";", 
      RowBox[{"ne", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "[", "nodes", "]"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ei", "=", 
          RowBox[{"elements", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"ne", "[", 
           RowBox[{"[", "ei", "]"}], "]"}], "+=", 
          RowBox[{
           RowBox[{"ve", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "/", 
           RowBox[{"Length", "[", "ei", "]"}]}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "elements", "]"}]}], "}"}]}], "]"}], ";", 
      "ne"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Simplex2Nodes", "[", 
    RowBox[{"nodes_List", ",", "elements_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ve", ",", "ne", ",", "ei"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ne", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "[", "nodes", "]"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ei", "=", 
          RowBox[{"elements", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"ne", "[", 
           RowBox[{"[", "ei", "]"}], "]"}], "+=", 
          RowBox[{
           RowBox[{"SimplexVolume", "[", 
            RowBox[{"nodes", "[", 
             RowBox[{"[", "ei", "]"}], "]"}], "]"}], "/", 
           RowBox[{"Length", "[", "ei", "]"}]}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "elements", "]"}]}], "}"}]}], "]"}], ";", 
      "ne"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ShowMesh", "[", 
    RowBox[{"m_", ",", 
     RowBox[{"withLable_:", "False"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{"withLable", ",", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"\"\<Wireframe\>\"", "[", 
         RowBox[{"\"\<MeshElementIDStyle\>\"", "\[Rule]", "Black"}], "]"}], 
        "]"}], ",", 
       RowBox[{"m", "[", 
        RowBox[{"\"\<Wireframe\>\"", "[", 
         RowBox[{
          RowBox[{"\"\<MeshElement\>\"", "\[Rule]", "\"\<PointElements\>\""}],
           ",", 
          RowBox[{"\"\<MeshElementIDStyle\>\"", "\[Rule]", "Red"}]}], "]"}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"Show", "[", 
      RowBox[{"m", "[", "\"\<Wireframe\>\"", "]"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"My3DpointPlot", "[", 
    RowBox[{"coord_", ",", "f_", ",", 
     RowBox[{"size_:", "10"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ri", "=", 
        RowBox[{"Min", "[", "f", "]"}]}], ",", 
       RowBox[{"rx", "=", 
        RowBox[{"Max", "[", "f", "]"}]}], ",", "data"}], "}"}], ",", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"coord", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"coord", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"coord", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", "f"}], "}"}], 
        "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Graphics3D", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"AbsolutePointSize", "[", "size", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Blend", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Blue", ",", "Red"}], "}"}], ",", 
               RowBox[{"Rescale", "[", 
                RowBox[{
                 RowBox[{"Last", "[", "#", "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ri", ",", "rx"}], "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"Point", "[", 
              RowBox[{"Most", "[", "#", "]"}], "]"}]}], "}"}], "&"}], "/@", 
          "data"}]}], "}"}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"data2", "=", 
     RowBox[{"GridNdim", "[", 
      RowBox[{"10", ",", "3"}], "]"}]}], ";", 
    RowBox[{"My3DpointPlot", "[", 
     RowBox[{"data2", ",", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"10", ",", 
        RowBox[{"Length", "[", "data2", "]"}]}], "]"}]}], "]"}]}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.777518313627676*^9, 3.7775183321137085`*^9}, {
   3.7775183824861965`*^9, 3.777518431938284*^9}, {3.7775186230842195`*^9, 
   3.777518624082621*^9}, {3.777630643331935*^9, 3.7776306705224905`*^9}, {
   3.779952408175609*^9, 3.779952415083741*^9}, {3.7799524661854877`*^9, 
   3.779952496482769*^9}, {3.780309752556026*^9, 3.780309754879174*^9}, {
   3.8374826270666375`*^9, 3.837482627378899*^9}, 3.837482782572697*^9},
 CellLabel->"In[7]:=",ExpressionUUID->"6d2de892-2e8b-4deb-a374-f2f3c3f08881"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"GridNdim", "[", 
     RowBox[{"xmin_List", ",", "xmax_List", ",", "dx_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"idx", "=", 
         RowBox[{"{", 
          RowBox[{
          "\"\<i\>\"", ",", "\"\<j\>\"", ",", "\"\<k\>\"", ",", "\"\<l\>\"", 
           ",", "\"\<m\>\"", ",", "\"\<n\>\"", ",", "\"\<o\>\"", ",", 
           "\"\<p\>\"", ",", "\"\<q\>\"", ",", "\"\<r\>\"", ",", "\"\<s\>\"", 
           ",", "\"\<t\>\""}], "}"}]}], ",", 
        RowBox[{"id2", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"st", "=", "\"\<Table[\>\""}], ",", "al", ",", 
        RowBox[{"nx", "=", 
         RowBox[{"Ceiling", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"xmax", "-", "xmin"}], ")"}], "/", "dx"}], "]"}]}], ",", 
        "ndx", ",", "dxL", ",", "ndim", ",", "res"}], "}"}], ",", 
      RowBox[{
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", "xmin", "]"}]}], ";", 
       RowBox[{"idx", "=", 
        RowBox[{"idx", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "ndim"}], "]"}], "]"}]}], ";", 
       RowBox[{"ndx", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"xmax", "-", "xmin"}], ")"}], "/", "nx"}]}], ";", 
       RowBox[{"st", "=", 
        RowBox[{"st", "<>", 
         RowBox[{"ToString", "[", "idx", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"id2", "=", 
          RowBox[{"id2", "<>", "\"\<,\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"idx", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", 
              RowBox[{"nx", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
       RowBox[{"al", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"ToExpression", "[", 
          RowBox[{"st", "<>", "id2", "<>", "\"\<]\>\""}], "]"}], "]"}]}], ";", 
       RowBox[{"res", "=", 
        RowBox[{"ArrayReshape", "[", 
         RowBox[{"al", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "al", "]"}], "/", "ndim"}], ",", "ndim"}],
            "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "i"}], "]"}], "]"}], "*=", 
          RowBox[{"ndx", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "+=", "xmin"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "res", "]"}]}], "}"}]}], "]"}], ";", 
       "res"}]}], "]"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{3.837483709722185*^9},
 CellLabel->"In[31]:=",ExpressionUUID->"062bb2f2-12f9-46e8-ba4e-e1deca1f3398"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ListMinus", "[", 
    RowBox[{"v1_List", ",", "v0_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v2", "=", "v1"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"v2", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "-=", "v0"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", "v2"}]}],
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FindPointsC1", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v1", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"y", ",", "r", ",", 
         RowBox[{"vt", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "v1", "]"}], "}"}]}], "]"}]}]}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ">", "xmin"}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "<", "xmax"}]}], ",", 
             RowBox[{
              RowBox[{"vt", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "=", "1"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Position", "[", 
         RowBox[{"vt", ",", "1"}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FindPointsC2", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v1", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmin", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"xmax", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"y", ",", "r", ",", 
         RowBox[{"vt", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "v1", "]"}], "}"}]}], "]"}]}]}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], ">", 
               RowBox[{"xmin", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], ">", 
               RowBox[{"xmin", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "<", 
               RowBox[{"xmax", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"v1", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "<", 
               RowBox[{"xmax", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"vt", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "=", "1"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Position", "[", 
         RowBox[{"vt", ",", "1"}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindPointsC3", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"v1", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"xmin", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"xmax", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"y", ",", "r", ",", 
          RowBox[{"vt", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"Length", "[", "v1", "]"}], "}"}]}], "]"}]}]}], "}"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"v1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], ">", 
                RowBox[{"xmin", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], " ", "&&", " ", 
               RowBox[{
                RowBox[{"v1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], ">", 
                RowBox[{"xmin", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], " ", "&&", 
               RowBox[{
                RowBox[{"v1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "3"}], "]"}], "]"}], ">", 
                RowBox[{"xmin", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], " ", "&&", " ", 
               RowBox[{
                RowBox[{"v1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "<", 
                RowBox[{"xmax", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], " ", "&&", " ", 
               RowBox[{
                RowBox[{"v1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "<", 
                RowBox[{"xmax", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "&&", " ", 
               RowBox[{
                RowBox[{"v1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "3"}], "]"}], "]"}], "<", 
                RowBox[{"xmax", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}]}], ",", 
              RowBox[{
               RowBox[{"vt", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "=", "1"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Position", "[", 
          RowBox[{"vt", ",", "1"}], "]"}]}]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Find", " ", "the", " ", "indices", " ", "of", " ", "particles", " ", 
     "in", " ", "v1", " ", "of", " ", "1"}], "-", 
    RowBox[{"3", " ", 
     RowBox[{
     "D", ".", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", "For"}], 
     " ", 
     RowBox[{"example", ":", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FindPointsC", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", 
           RowBox[{"-", "1"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.5", ",", "0.5"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
       "is", " ", "to", " ", "find", " ", "the", " ", "index", " ", "of", " ",
        "particle", " ", "in", " ", "rectange", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "1"}]}], "}"}], " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.5", ",", "0.5"}], "}"}], "."}]}]}]}]}], " ", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindPointsC", "[", 
    RowBox[{"v1_List", ",", "xmin_List", ",", "xmax_List"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Switch", "[", 
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"v1", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "0", ",", 
      RowBox[{"FindPointsC1", "[", 
       RowBox[{"v1", ",", "xmin", ",", "xmax"}], "]"}], ",", "2", ",", 
      RowBox[{"FindPointsC2", "[", 
       RowBox[{"v1", ",", "xmin", ",", "xmax"}], "]"}], ",", "3", ",", 
      RowBox[{"FindPointsC3", "[", 
       RowBox[{"v1", ",", "xmin", ",", "xmax"}], "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{
  3.783176959485343*^9, {3.8374224089981537`*^9, 3.837422556897552*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"44c55d01-48d4-4408-839b-c740830bcd9a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "SegmentListCut2P", " ", "creates", " ", "initial", " ", "crack", " ", 
    "in", " ", "2", "D", " ", "by", " ", "modifying", " ", "the", " ", 
    "neighbour", " ", 
    RowBox[{"list", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SegmentListCut2P", "[", 
      RowBox[{"segL_List", ",", "p1_", ",", "p2_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fd", "=", "False"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"SegmentCut2P", "[", 
             RowBox[{
              RowBox[{"segL", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "p1", ",", "p2"}], "]"}], 
            ",", 
            RowBox[{
             RowBox[{"fd", "=", "True"}], ";", 
             RowBox[{"Break", "[", "]"}], ";"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "segL", "]"}]}], "}"}]}], "]"}], ";", 
        "fd"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "PlaneListCut2P", " ", "creates", " ", "the", " ", "initial", " ", 
     "crack", " ", "surface", " ", "in", " ", "3", "D", " ", "by", " ", 
     "modifying", " ", "the", " ", "neighbor", " ", "list"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PlaneListCut2P", "[", 
      RowBox[{"p3dL_List", ",", "p1_", ",", "p2_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "fd", "}"}], ",", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"PlaneCut2P", "[", 
             RowBox[{
              RowBox[{"p3dL", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "p1", ",", "p2"}], "]"}], 
            ",", 
            RowBox[{
             RowBox[{"fd", "=", "True"}], ";", 
             RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "p3dL", "]"}]}], "}"}]}], "]"}], ";", 
        "fd"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.76346528345426*^9, 3.763465476715314*^9}, {
  3.763468327631377*^9, 3.7634683747400713`*^9}, {3.763468593140563*^9, 
  3.763468646653624*^9}, {3.8374223043502016`*^9, 3.8374223894981937`*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"8b7c0f1d-efbd-434a-bbd7-1d4323cc6c7d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CheckTextCommand", "[", "path_String", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "res", "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FileExistsQ", "[", "path", "]"}], ",", 
       RowBox[{
        RowBox[{"res", "=", 
         RowBox[{
          RowBox[{"ReadList", "[", 
           RowBox[{"path", ",", "String", ",", "1"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"StringStartsQ", "[", 
           RowBox[{"res", ",", "\"\<1\>\""}], "]"}], ",", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<Abort command was found in file: \>\"", ",", "path"}], "]"}],
            ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}]}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",
 CellLabel->"In[39]:=",ExpressionUUID->"e887727e-cda6-40fc-a299-0b6451139219"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Geometrical", " ", "tools", " ", "for", " ", "intersection", " ", 
    "calculation"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SegmentCut2P", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x0_", ",", "y0_", ",", "x1_", ",", "y1_"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2_", ",", "y2_"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x3_", ",", "y3_"}], "}"}]}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"t1", ",", "t2", ",", "t3", ",", "t4"}], "}"}], ",", 
       RowBox[{
        RowBox[{"t1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x2", "-", "x0"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"y1", "-", "y0"}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y2", "-", "y0"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"x1", "-", "x0"}], ")"}]}]}]}], ";", 
        RowBox[{"t2", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x3", "-", "x0"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"y1", "-", "y0"}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y3", "-", "y0"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"x1", "-", "x0"}], ")"}]}]}]}], ";", 
        RowBox[{"t3", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x0", "-", "x2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"y3", "-", "y2"}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y0", "-", "y2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"x3", "-", "x2"}], ")"}]}]}]}], ";", 
        RowBox[{"t4", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"x1", "-", "x2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"y3", "-", "y2"}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y1", "-", "y2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"x3", "-", "x2"}], ")"}]}]}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"t1", "*", "t2"}], "<", "0"}], " ", "&&", " ", 
           RowBox[{
            RowBox[{"t3", "*", "t4"}], "<", "0"}]}], ",", 
          RowBox[{"Return", "[", "True", "]"}], ",", 
          RowBox[{"Return", "[", "False", "]"}]}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PlaneCut2P", "[", 
      RowBox[{"p3d_List", ",", "p4_", ",", "p5_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "p0", ",", "n1", ",", "r0", ",", "rn", ",", "n45", ",", "nn", ",", 
         "d", ",", "p", ",", "dis", ",", "p1", ",", "p2", ",", "p3", ",", 
         "area"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "p3d", "]"}], "\[Equal]", "7"}], ",", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"//", 
             RowBox[{
              RowBox[{"/", "circle"}], " ", "plane", " ", "in", " ", "3", 
              RowBox[{"d", ":", "x0"}]}]}], ",", "y0", ",", "z0", ",", "n1", 
            ",", "n2", ",", "n3", ",", 
            RowBox[{"r0", ";"}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"p0", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"n1", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"4", ";;", "6"}], "]"}], "]"}]}], ";", 
           RowBox[{"r0", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", "7", "]"}], "]"}]}], ";", 
           RowBox[{"rn", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n1", ".", "n1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"n1", "=", 
            RowBox[{
             RowBox[{"1.", "/", "rn"}], "*", "n1"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"n45", "=", 
            RowBox[{"p5", "-", "p4"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"nn", "=", 
            RowBox[{"n1", ".", "n45"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "nn", "]"}], "<", 
              RowBox[{"10", "^", 
               RowBox[{"-", "5"}]}]}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"d", "=", 
            RowBox[{
             RowBox[{"1", "/", "nn"}], "*", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"p0", "-", "p4"}], ")"}], ".", "n1"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"d", "\[GreaterEqual]", "1"}], " ", "||", " ", 
              RowBox[{"d", "<", "0."}]}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"p", "=", 
            RowBox[{
             RowBox[{"d", " ", "n45"}], "+", "p4"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"dis", "=", 
            RowBox[{"Norm", "[", 
             RowBox[{"p", "-", "p0"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"dis", "\[LessEqual]", "r0"}], ",", 
             RowBox[{"Return", "[", "True", "]"}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "p3d", "]"}], "\[Equal]", "12"}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"//", 
             RowBox[{"plane3D", ":", 
              RowBox[{"x1", " ", "y1", " ", "z1"}]}]}], ",", 
            RowBox[{"x2", " ", "y2", " ", "z2"}], ",", 
            RowBox[{"x3", " ", "y3", " ", "z3"}], ",", 
            RowBox[{
             RowBox[{"x4", " ", "y4", " ", "z4"}], ";"}]}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"p0", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";", 
           RowBox[{"p1", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"4", ";;", "6"}], "]"}], "]"}]}], ";", 
           RowBox[{"p2", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"7", ";;", "9"}], "]"}], "]"}]}], ";", 
           RowBox[{"p3", "=", 
            RowBox[{"p3d", "[", 
             RowBox[{"[", 
              RowBox[{"10", ";;", "12"}], "]"}], "]"}]}], ";", 
           RowBox[{"n1", "=", 
            RowBox[{"Cross", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"p1", "-", "p0"}], ")"}], ",", 
              RowBox[{"p2", "-", "p0"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"n1", "*=", 
            RowBox[{"1", "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"n1", ".", "n1"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"n45", "=", 
            RowBox[{"p5", "-", "p4"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"nn", "=", 
            RowBox[{"n1", ".", "n45"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "nn", "]"}], "<", 
              RowBox[{"10", "^", 
               RowBox[{"-", "5"}]}]}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"d", "=", 
            RowBox[{
             RowBox[{"1", "/", "nn"}], "*", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"p0", "-", "p4"}], ")"}], ".", "n1"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"d", "\[GreaterEqual]", "1."}], "||", 
              RowBox[{"d", "<", "0."}]}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"p", "=", 
            RowBox[{
             RowBox[{"d", "*", "n45"}], "+", "p4"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"area", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Area3point", "[", 
                 RowBox[{"p0", ",", "p1", ",", "p"}], "]"}], ",", 
                RowBox[{"Area3point", "[", 
                 RowBox[{"p1", ",", "p2", ",", "p"}], "]"}], ",", 
                RowBox[{"Area3point", "[", 
                 RowBox[{"p2", ",", "p3", ",", "p"}], "]"}], ",", 
                RowBox[{"Area3point", "[", 
                 RowBox[{"p3", ",", "p0", ",", "p"}], "]"}]}], "}"}]}], ";"}],
             "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"p1", "-", "p0"}], ",", 
               RowBox[{"p", "-", "p0"}]}], "]"}], ",", 
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"p3", "-", "p2"}], ",", 
               RowBox[{"p", "-", "p2"}]}], "]"}], ",", 
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"p2", "-", "p1"}], ",", 
               RowBox[{"p", "-", "p1"}]}], "]"}], ",", 
             RowBox[{"Cross", "[", 
              RowBox[{
               RowBox[{"p0", "-", "p3"}], ",", 
               RowBox[{"p", "-", "p3"}]}], "]"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"p1", "-", "p0"}], ",", 
                  RowBox[{"p", "-", "p0"}]}], "]"}], ".", 
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"p3", "-", "p2"}], ",", 
                  RowBox[{"p", "-", "p2"}]}], "]"}]}], "\[GreaterEqual]", 
               "0."}], " ", "&&", 
              RowBox[{
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"p2", "-", "p1"}], ",", 
                  RowBox[{"p", "-", "p1"}]}], "]"}], ".", 
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"p0", "-", "p3"}], ",", 
                  RowBox[{"p", "-", "p3"}]}], "]"}]}], "\[GreaterEqual]", 
               "0."}]}], ",", 
             RowBox[{"Return", "[", "True", "]"}], ",", 
             RowBox[{"Return", "[", "False", "]"}]}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Error,the plane is not well defined\>\"", ",", "p3d"}], 
         "]"}], ";", 
        RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Area3point", "[", 
      RowBox[{"p1_", ",", "p2_", ",", "p3_"}], "]"}], ":=", 
     RowBox[{"0.5", 
      RowBox[{"Norm", "[", 
       RowBox[{"Cross", "[", 
        RowBox[{
         RowBox[{"p2", "-", "p1"}], ",", 
         RowBox[{"p3", "-", "p1"}]}], "]"}], "]"}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PointOnTriangle", "[", 
      RowBox[{"v1_", ",", "p1_", ",", "p2_", ",", "p3_", ",", "eps_"}], "]"}],
      ":=", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{"3", "D", " ", "case"}], ";", 
        RowBox[{"-", "1"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "normal"}], " ", "direction"}], ";", "0"}], ",", 
       RowBox[{
        RowBox[{"not", " ", "on"}], ";", "1"}], ",", 
       RowBox[{
        RowBox[{"normal", " ", "direction"}], ";"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x", ",", "y", ",", "z", ",", "d", ",", "x1", ",", "y1", ",", "z1", 
         ",", "x2", ",", "y2", ",", "z2", ",", "x3", ",", "y3", ",", "z3", 
         ",", "A1", ",", "A2", ",", "A", ",", "normal"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x2", ",", "y2", ",", "z2"}], "}"}], "=", 
         RowBox[{"p2", "-", "p1"}]}], ";", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x3", ",", "y3", ",", "z3"}], "}"}], "=", 
         RowBox[{"p3", "-", "p1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"normal", "=", 
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x2", ",", "y2", ",", "z2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"x3", ",", "y3", ",", "z3"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", 
         RowBox[{"v1", "-", "p1"}]}], ";", 
        RowBox[{"d", "=", 
         RowBox[{"normal", ".", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "z"}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"d", "\[LessEqual]", 
            RowBox[{"-", "eps"}]}], " ", "||", " ", 
           RowBox[{"d", "\[GreaterEqual]", "eps"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x1", ",", "y1", ",", "z1"}], "}"}], "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x", ",", "y", ",", "z"}], "}"}], "-", 
          RowBox[{"d", "*", "normal"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"A1", "=", 
         RowBox[{"normal", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"y2", " ", "z1"}], "-", 
             RowBox[{"y1", " ", "z2"}]}], ",", 
            RowBox[{
             RowBox[{"z2", " ", "x1"}], "-", 
             RowBox[{"z1", " ", "x2"}]}], ",", 
            RowBox[{
             RowBox[{"x2", " ", "y1"}], "-", 
             RowBox[{"x1", " ", "y2"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"A2", "=", 
         RowBox[{"normal", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"y1", " ", "z3"}], "-", 
             RowBox[{"y3", " ", "z1"}]}], ",", 
            RowBox[{
             RowBox[{"z1", " ", "x3"}], "-", 
             RowBox[{"z3", " ", "x1"}]}], ",", 
            RowBox[{
             RowBox[{"x1", " ", "y3"}], "-", 
             RowBox[{"x3", " ", "y1"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"A", "=", 
         RowBox[{"normal", ".", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"y2", " ", "z3"}], "-", 
             RowBox[{"y3", " ", "z2"}]}], ",", 
            RowBox[{
             RowBox[{"z2", " ", "x3"}], "-", 
             RowBox[{"z3", " ", "x2"}]}], ",", 
            RowBox[{
             RowBox[{"x2", " ", "y3"}], "-", 
             RowBox[{"x3", " ", "y2"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Sign", "[", "A1", "]"}], "\[NotEqual]", 
           RowBox[{"Sign", "[", "A2", "]"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"A1", "+", "A2"}], "]"}], ">", 
           RowBox[{"Abs", "[", "A", "]"}]}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"d", "\[GreaterEqual]", "0"}], ",", 
          RowBox[{"Return", "[", "1", "]"}], ",", 
          RowBox[{"Return", "[", "2", "]"}]}], "]"}]}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7634523433251266`*^9, 3.763452345771267*^9}, {
  3.7634524183774195`*^9, 3.763452447218069*^9}, {3.7634524778878236`*^9, 
  3.763452493773732*^9}, {3.763452529787792*^9, 3.7634525776675305`*^9}, {
  3.763452652559814*^9, 3.7634526573040857`*^9}, {3.763463486007452*^9, 
  3.7634635033734455`*^9}, {3.7799530747853947`*^9, 3.779953086758194*^9}, {
  3.779953135612227*^9, 3.77995313622117*^9}, {3.780830392589905*^9, 
  3.780830395383935*^9}, {3.780830427051775*^9, 3.780830494025241*^9}, {
  3.780830539530507*^9, 3.780830565849052*^9}, {3.780830780843484*^9, 
  3.780830838540791*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"b1a6705e-7d61-4be8-b455-f971b3c1f307"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SimplexVolume", "[", "coord_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"v1", "=", 
        RowBox[{"{", "}"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", "coord", "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"v1", ",", 
          RowBox[{
           RowBox[{"coord", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "-", 
           RowBox[{"coord", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", "n"}], "}"}]}], "]"}], ";", 
      RowBox[{
       RowBox[{"Abs", "[", 
        RowBox[{"Det", "[", 
         RowBox[{"v1", "//", "N"}], "]"}], "]"}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "1"}], ")"}], "!"}], ")"}]}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ComplementOrder", "[", 
    RowBox[{"vs_List", ",", "vi_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"v2", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"True", ",", 
          RowBox[{"Length", "[", "vs", "]"}]}], "]"}]}], ",", "vi2"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"{", "List", "}"}], ",", 
          RowBox[{"Head", "[", "vi", "]"}]}], "]"}], ",", 
        RowBox[{"vi2", "=", "vi"}], ",", 
        RowBox[{"vi2", "=", 
         RowBox[{"{", "vi", "}"}]}]}], "]"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"vs", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "\[Equal]", 
             RowBox[{"vi2", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"v2", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", "False"}], ";", 
             RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"Length", "[", "vs", "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "vi2", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"vs", "[", 
       RowBox[{"[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"v2", ",", "True"}], "]"}], "]"}], "]"}], "]"}]}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.783174312042918*^9, 3.783174312480943*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"d26d5d72-0b86-4864-9123-14f4e79d04bb"],

Cell[CellGroupData[{

Cell["\<\
NeighborUpdateByPlane creates the initial crack surface in 3D by modifying \
the neighbor list\
\>", "Subsubsection",
 CellChangeTimes->{
  3.8374829526247344`*^9},ExpressionUUID->"b8c93c79-1b68-4bc4-96ad-\
4effa00a0704"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "the", " ", "parameter", " ", "SegmentListCut2P", " ", "is", " ", 
     "SegmentListCut2P", " ", "for", " ", "2", "D", " ", "or", " ", 
     "PlaneListCut2P", " ", "for", " ", "3", "D"}], ",", " ", 
    "\[IndentingNewLine]", 
    RowBox[{
    "NeighborUpdateByPlane", " ", "creates", " ", "the", " ", "initial", " ", 
     "crack", " ", "surface", " ", "in", " ", "3", "D", " ", "by", " ", 
     "modifying", " ", "the", " ", "neighbor", " ", "list"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"NeighborUpdateByPlane", "[", 
      RowBox[{
      "nei_List", ",", "coord_List", ",", "geoM_List", ",", 
       "SegmentListCut2P_", ",", "xmin_", ",", "xmax_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Nei", ",", "pin", ",", 
         RowBox[{"broNei", "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"Length", "[", "coord", "]"}]}], "]"}]}], ",", "ni", ",", 
         "xi", ",", "xiN", ",", "broI"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Nei", "=", "nei"}], ";", "\[IndentingNewLine]", 
        RowBox[{"pin", "=", 
         RowBox[{"FindPoints", "[", 
          RowBox[{"coord", ",", "xmin", ",", "xmax"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ni", "=", 
            RowBox[{"nei", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"xi", "=", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"xiN", "=", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "ni", "]"}], "]"}]}], ";", 
           RowBox[{"broI", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"SegmentListCut2P", "[", 
                RowBox[{"geoM", ",", "xi", ",", 
                 RowBox[{"xiN", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"broI", ",", 
                 RowBox[{"ni", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", 
               RowBox[{"Length", "[", "ni", "]"}]}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"broNei", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", "broI"}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "pin"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Nei", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"ComplementOrder", "[", 
            RowBox[{
             RowBox[{"nei", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"broNei", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "pin"}], "}"}]}], "]"}], ";", 
        RowBox[{"{", 
         RowBox[{"Nei", ",", "broNei"}], "}"}]}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"NeighborUpdateByPlane", "[", 
      RowBox[{
      "nei_List", ",", "coord_List", ",", "geoM_List", ",", 
       "SegmentListCut2P_", ",", "checkList_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Nei", ",", "pin", ",", 
         RowBox[{"broNei", "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"Length", "[", "coord", "]"}]}], "]"}]}], ",", "ni", ",", 
         "xi", ",", "xiN", ",", "broI"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Nei", "=", "nei"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ni", "=", 
            RowBox[{"nei", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"xi", "=", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"xiN", "=", 
            RowBox[{"coord", "[", 
             RowBox[{"[", "ni", "]"}], "]"}]}], ";", 
           RowBox[{"broI", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"SegmentListCut2P", "[", 
                RowBox[{"geoM", ",", "xi", ",", 
                 RowBox[{"xiN", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"broI", ",", 
                 RowBox[{"ni", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", 
               RowBox[{"Length", "[", "ni", "]"}]}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"broNei", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", "broI"}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "checkList"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Nei", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"ComplementOrder", "[", 
            RowBox[{
             RowBox[{"nei", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"broNei", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "checkList"}], "}"}]}], "]"}], ";", 
        RowBox[{"{", 
         RowBox[{"Nei", ",", "broNei"}], "}"}]}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.780310400483437*^9, 3.780310400485557*^9}, {
  3.837482854105311*^9, 3.837482932488825*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"7e312687-7d02-46d8-8efd-d220cac82664"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MyPlotPoint", "[", 
     RowBox[{"coord_List", ",", "u_List", ",", 
      RowBox[{"plotRange_:", "Automatic"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Nnode", "=", 
         RowBox[{"Length", "[", "coord", "]"}]}], ",", 
        RowBox[{"ndim", "=", 
         RowBox[{"Length", "[", 
          RowBox[{"coord", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{"xyz", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"uv", "=", 
         RowBox[{"{", 
          RowBox[{"\"\<u\>\"", ",", "\"\<v\>\"", ",", "\"\<w\>\""}], "}"}]}], 
        ",", "r", ",", "r2"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "coord", "]"}], ">", 
          RowBox[{"Length", "[", "u", "]"}]}], ",", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<Error,u is less than coord\>\"", "]"}], 
          ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
       RowBox[{"xyz", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"Nnode", ",", 
            RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"xyz", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "u", "]"}], "\[Equal]", "Nnode"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"xyz", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", "u"}], ";", 
          RowBox[{
           RowBox[{
            RowBox[{"CellPrint", "@", 
             RowBox[{"ExpressionCell", "[", 
              RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
           RowBox[{"{", 
            RowBox[{"ListPointPlot3D", "[", 
             RowBox[{"xyz", ",", 
              RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", " ", 
              RowBox[{"Axes", "\[Rule]", "True"}], ",", 
              RowBox[{"AxesLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
              RowBox[{"PlotLabel", "\[Rule]", "\"\<u\>\""}], ",", 
              RowBox[{"PlotRange", "\[Rule]", "plotRange"}], ",", " ", 
              RowBox[{
              "ColorFunction", "\[Rule]", "\"\<SouthwestColors\>\""}]}], 
             "]"}], "}"}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"xyz", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", 
                RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", 
             RowBox[{"u", "[", 
              RowBox[{"[", 
               RowBox[{"iu", ";;", 
                RowBox[{"-", "1"}], ";;", "ndim"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"CellPrint", "@", 
               RowBox[{"ExpressionCell", "[", 
                RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
             RowBox[{"{", 
              RowBox[{"ListPointPlot3D", "[", 
               RowBox[{"xyz", ",", 
                RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
                RowBox[{"Axes", "\[Rule]", "True"}], ",", 
                RowBox[{"AxesLabel", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
                RowBox[{"PlotLabel", "\[Rule]", 
                 RowBox[{
                 "uv", "\[LeftDoubleBracket]", "iu", 
                  "\[RightDoubleBracket]"}]}], ",", " ", 
                RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
               "]"}], "}"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"iu", ",", "ndim"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}]}],
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Cartesian", " ", "grid", " ", "or", " ", "Regular", " ", "grid", " ", 
    "in", " ", "2", "D", " ", "and", " ", "3", "D"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GridDomain", "[", 
    RowBox[{"xmin_", ",", "xmax_", ",", "dx_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", "xmin", "]"}]}], ",", 
       RowBox[{"nx", "=", 
        RowBox[{"Ceiling", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"xmax", "-", "xmin"}], ")"}], "/", "dx"}], "]"}]}], ",", 
       "dx2", ",", "res"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dx2", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"xmax", "-", "xmin"}], ")"}], "/", "nx"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "2"}], ",", 
        RowBox[{"res", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "j"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"nx", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "0", ",", 
             RowBox[{"nx", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "3"}], ",", 
        RowBox[{"res", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"nx", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "0", ",", 
             RowBox[{"nx", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "0", ",", 
             RowBox[{"nx", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"Flatten", "[", "res", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"res", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "res", "]"}], "/", "ndim"}], ",", "ndim"}],
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"res", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "i"}], "]"}], "]"}], "*=", 
         RowBox[{"dx2", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"res", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "+=", "xmin"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "res", "]"}]}], "}"}]}], "]"}], ";", 
      "res"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindPoints", "[", 
    RowBox[{"v1_List", ",", "xmin_List", ",", "xmax_List", ",", 
     RowBox[{"show_:", "False"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ilist", "=", 
        RowBox[{"{", "}"}]}], ",", "y", ",", "r", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"v1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "v1", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"LessThan2", "[", 
            RowBox[{
             RowBox[{"v1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "xmax"}], "]"}], "&&", " ", 
           RowBox[{"LessThan2", "[", 
            RowBox[{"xmin", ",", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ilist", ",", "i"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"show", ",", 
        RowBox[{
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", "ilist", "]"}], "]"}], ",", 
              RowBox[{"DataRange", "\[Rule]", "Automatic"}]}], "]"}], "]"}]}],
           "]"}], ";", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"v1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{
             RowBox[{"ListPointPlot3D", "[", 
              RowBox[{"v1", "[", 
               RowBox[{"[", "ilist", "]"}], "]"}], "]"}], ",", 
             RowBox[{"DataRange", "\[Rule]", "Full"}]}], "]"}]}], "]"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", "ilist"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LessThan2", "[", 
    RowBox[{"v1_List", ",", "v2_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p", "=", "True"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"v1", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ">", " ", 
           RowBox[{"v2", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"p", "=", "False"}], ";", 
           RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "v1", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Return", "[", "p", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyDensityPlot", "[", 
    RowBox[{"coord_List", ",", "u_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Nnode", "=", 
        RowBox[{"Length", "[", "coord", "]"}]}], ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"xyz", "=", 
        RowBox[{"{", "}"}]}], ",", "r", ",", "r2"}], "}"}], ",", 
     RowBox[{
      RowBox[{"xyz", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"Nnode", ",", 
           RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"xyz", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
      RowBox[{"r", "=", 
       RowBox[{"ListRange", "[", "coord", "]"}]}], ";", 
      RowBox[{"r2", "=", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "-", 
        RowBox[{"r", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
      RowBox[{"r2", "=", 
       RowBox[{
        RowBox[{"r2", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "/", 
        RowBox[{"r2", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "u", "]"}], "\[Equal]", "Nnode"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"xyz", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", "u"}], ";", 
         RowBox[{
          RowBox[{
           RowBox[{"CellPrint", "@", 
            RowBox[{"ExpressionCell", "[", 
             RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"ListDensityPlot", "[", 
            RowBox[{"xyz", ",", 
             RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
             RowBox[{"AspectRatio", "\[Rule]", "r2"}], ",", " ", 
             RowBox[{"Axes", "\[Rule]", "True"}], ",", 
             RowBox[{"AxesLabel", "\[Rule]", 
              RowBox[{"Table", "[", 
               RowBox[{"i", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "ndim"}], "}"}]}], "]"}]}], ",", 
             
             RowBox[{"Mesh", "\[Rule]", "All"}], ",", 
             RowBox[{"InterpolationOrder", "\[Rule]", "3"}], ",", 
             RowBox[{
             "ColorFunction", "\[Rule]", "\"\<SouthwestColors\>\""}]}], "]"}],
            "}"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"xyz", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"ndim", "+", "1"}]}], "]"}], "]"}], "=", 
            RowBox[{"u", "[", 
             RowBox[{"[", 
              RowBox[{"iu", ";;", 
               RowBox[{"-", "1"}], ";;", "ndim"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"CellPrint", "@", 
              RowBox[{"ExpressionCell", "[", 
               RowBox[{"#", ",", "\"\<Output\>\""}], "]"}]}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{"ListDensityPlot", "[", 
              RowBox[{"xyz", ",", 
               RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
               RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
               RowBox[{"AspectRatio", "\[Rule]", "r2"}], ",", " ", 
               RowBox[{"Axes", "\[Rule]", "True"}], ",", 
               RowBox[{"Mesh", "\[Rule]", "All"}], ",", 
               RowBox[{"AxesLabel", "\[Rule]", 
                RowBox[{"Table", "[", 
                 RowBox[{"i", ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", "ndim"}], "}"}]}], "]"}]}], 
               ",", 
               RowBox[{"InterpolationOrder", "\[Rule]", "3"}], ",", 
               RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
              "]"}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"iu", ",", "ndim"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ListRange", "[", "xy_List", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ndim", ",", "r"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ndim", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"xy", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"r", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "ndim"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"r", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "i"}], "]"}], "]"}], "=", 
          RowBox[{"Min", "[", 
           RowBox[{"xy", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"r", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "i"}], "]"}], "]"}], "=", 
          RowBox[{"Max", "[", 
           RowBox[{"xy", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", "r"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.83748373171659*^9, 3.83748374088372*^9}, {
  3.837483780722627*^9, 3.8374838001552334`*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"e0cd63e4-8345-4f4e-9443-57f10737291d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Partition", " ", "the", " ", "coord", " ", "based", " ", "on", " ", "the",
     " ", "Neighbor", " ", 
    RowBox[{"list", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"NeighborPartition", "[", 
      RowBox[{"coord_List", ",", "Nei_List"}], "]"}], ":=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"coord", "[", 
        RowBox[{"[", 
         RowBox[{"Nei", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"WeightByNeighbor", "[", 
      RowBox[{"neicoord_List", ",", "WeiF_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"res", "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0.", ",", 
            RowBox[{
             RowBox[{"Dimensions", "[", "neicoord", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], "]"}]}], ",", "ni", 
         ",", "ri"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ni", "=", 
            RowBox[{"neicoord", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ri", "=", 
               RowBox[{
                RowBox[{"ni", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "-", 
                RowBox[{"ni", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
              RowBox[{
               RowBox[{"res", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
               RowBox[{"WeiF", "[", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"ri", ".", "ri"}], "]"}], "]"}]}], ";"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "2", ",", 
               RowBox[{"Length", "[", "ni", "]"}]}], "}"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "neicoord", "]"}]}], "}"}]}], "]"}], ";", 
        "res"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.778393666066318*^9, 3.778393676643923*^9}, {
  3.8374831695982895`*^9, 3.8374831836759167`*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"af4243db-2fe4-455e-8588-abea6568ed0e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"The", " ", "radius", " ", "of", " ", "the", " ", "support"}], 
    ",", " ", 
    RowBox[{
    "the", " ", "furthest", " ", "distant", " ", "of", " ", "particle", " ", 
     "in", " ", "support"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"RadiusByNeighborC", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"ni", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"res", ",", "rii", ",", 
           RowBox[{"dm", "=", 
            RowBox[{"Dimensions", "[", "ni", "]"}]}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"res", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"10.", "^", 
              RowBox[{"-", "10"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"dm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"rii", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", 
              RowBox[{"dm", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"rii", "=", 
              RowBox[{
               RowBox[{"ni", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"ni", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             RowBox[{
              RowBox[{"res", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"Sqrt", "[", 
               RowBox[{"rii", ".", "rii"}], "]"}]}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2", ",", 
              RowBox[{"Length", "[", "ni", "]"}]}], "}"}]}], "]"}], ";", 
          "res"}]}], "]"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"RuntimeOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], 
         "}"}]}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"WeightByNeighborC", "[", 
      RowBox[{"neicoord_List", ",", "WeiF_"}], "]"}], ":=", 
     RowBox[{"WeiF", "/@", 
      RowBox[{"RadiusByNeighborC", "[", "neicoord", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WeightByNeighborC2", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"ni", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"res", ",", "rii", ",", 
           RowBox[{"dm", "=", 
            RowBox[{"Dimensions", "[", "ni", "]"}]}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"res", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"10.", "^", 
              RowBox[{"-", "10"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"dm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"rii", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", 
              RowBox[{"dm", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"rii", "=", 
              RowBox[{
               RowBox[{"ni", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"ni", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             RowBox[{
              RowBox[{"res", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"1", "/", 
               RowBox[{"(", 
                RowBox[{"rii", ".", "rii"}], ")"}]}]}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2", ",", 
              RowBox[{"Length", "[", "ni", "]"}]}], "}"}]}], "]"}], ";", 
          "res"}]}], "]"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"RuntimeOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], 
         "}"}]}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{
  3.7809868681918993`*^9, {3.78098691436047*^9, 3.780986966071909*^9}, {
   3.780987466717574*^9, 3.7809875251268597`*^9}, {3.7809876454608173`*^9, 
   3.780987704333213*^9}, {3.7809877406672153`*^9, 3.780987835895979*^9}, {
   3.780987875434574*^9, 3.7809879153873463`*^9}, {3.780988018037259*^9, 
   3.780988024437977*^9}, {3.780988073391163*^9, 3.7809881142976713`*^9}, {
   3.7809883671756153`*^9, 3.780988376923181*^9}, {3.7809885149266777`*^9, 
   3.780988524934155*^9}, {3.780988562382882*^9, 3.7809885625016212`*^9}, 
   3.780988664388731*^9, {3.7809889002972527`*^9, 3.780988989318201*^9}, {
   3.780989022390874*^9, 3.780989026132859*^9}, {3.780989242993586*^9, 
   3.7809892567340384`*^9}, {3.7809893087781343`*^9, 
   3.7809893087887707`*^9}, {3.780989828699469*^9, 3.7809898583318*^9}, {
   3.83748320226266*^9, 3.8374832222633014`*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"912f7897-bab0-4cd2-bd8f-6eaa4185199d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NeighborPartitionC2", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coord", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nei", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"coord", "[", 
        RowBox[{"[", 
         RowBox[{"Nei", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NeighborPartitionC1", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coord", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nei", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"coord", "[", 
        RowBox[{"[", 
         RowBox[{"Nei", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NeighborPartitionC3", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coord", ",", "_Real", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nei", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"coord", "[", 
        RowBox[{"[", 
         RowBox[{"Nei", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NeighborPartitionC", "[", 
   RowBox[{"coord_List", ",", "Nei_List"}], "]"}], ":=", 
  RowBox[{"Switch", "[", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"coord", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "0", ",", 
    RowBox[{"NeighborPartitionC1", "[", 
     RowBox[{"coord", ",", "Nei"}], "]"}], ",", "1", ",", 
    RowBox[{"NeighborPartitionC2", "[", 
     RowBox[{"coord", ",", "Nei"}], "]"}], ",", "2", ",", 
    RowBox[{"NeighborPartitionC3", "[", 
     RowBox[{"coord", ",", "Nei"}], "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.780984324394328*^9, 3.780984442755371*^9}, {
  3.780984515155251*^9, 3.780984555550775*^9}, {3.780984597850531*^9, 
  3.780984616956205*^9}, {3.780984666187606*^9, 3.780984755784322*^9}, {
  3.780986822262473*^9, 3.780986823335338*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"c4aebb53-7f7e-40a8-ae3a-81b783d030d7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NeighborPartitionC2", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coord", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nei", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"coord", "[", 
        RowBox[{"[", 
         RowBox[{"Nei", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
     RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NeighborPartitionC1", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coord", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nei", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"coord", "[", 
        RowBox[{"[", 
         RowBox[{"Nei", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
     RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NeighborPartitionC3", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coord", ",", "_Real", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nei", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"coord", "[", 
        RowBox[{"[", 
         RowBox[{"Nei", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
     RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NeighborPartitionC", "[", 
   RowBox[{"coord_List", ",", "Nei_List"}], "]"}], ":=", 
  RowBox[{"Switch", "[", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"coord", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "0", ",", 
    RowBox[{"NeighborPartitionC1", "[", 
     RowBox[{"coord", ",", "Nei"}], "]"}], ",", "1", ",", 
    RowBox[{"NeighborPartitionC2", "[", 
     RowBox[{"coord", ",", "Nei"}], "]"}], ",", "2", ",", 
    RowBox[{"NeighborPartitionC3", "[", 
     RowBox[{"coord", ",", "Nei"}], "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.780985107001548*^9, 3.780985115842593*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"f4f27d16-93da-4775-a382-d07a7db13f5e"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"NeighborPartitionParallel", "[", 
     RowBox[{"coord_List", ",", "Nei_List"}], "]"}], ":=", 
    RowBox[{"ParallelTable", "[", 
     RowBox[{
      RowBox[{"coord", "[", 
       RowBox[{"[", 
        RowBox[{"Nei", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "Nei", "]"}]}], "}"}]}], "]"}]}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.780982633457193*^9, 3.7809826394604063`*^9}, 
   3.780986627744466*^9},
 CellLabel->"In[67]:=",ExpressionUUID->"a5f9156a-3515-4bb4-bfa5-9b44400727bb"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "SaveToCell", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SaveToCell", "::", "usage"}], "=", 
   RowBox[{
   "\"\<SaveToCell[variable] creates an input cell that reassigns the current \
value of variable.\\n\>\"", "<>", 
    "\"\<SaveToCell[variables, display] shows 'display' on the \
right-hand-side of the assignment.\>\""}]}], ";"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"SaveToCell", ",", "HoldFirst"}], "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SaveToCell", "[", 
    RowBox[{"var_", ",", 
     RowBox[{"name", ":", 
      RowBox[{"Except", "[", 
       RowBox[{"_", "?", "OptionQ"}], "]"}], ":", "\"\<data\>\""}], ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Compress", "[", "var", "]"}]}], ",", 
       RowBox[{"panel", "=", 
        RowBox[{"ToBoxes", "@", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Panel", "[", 
            RowBox[{"name", ",", 
             RowBox[{"FrameMargins", "\[Rule]", "Small"}]}], "]"}], ",", 
           RowBox[{"DateString", "[", "]"}]}], "]"}]}]}]}], "}"}], ",", 
     RowBox[{"CellPrint", "@", 
      RowBox[{"Cell", "[", 
       RowBox[{
        RowBox[{"BoxData", "@", 
         RowBox[{"RowBox", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"MakeBoxes", "[", "var", "]"}], ",", "\"\<=\>\"", ",", 
            RowBox[{"InterpretationBox", "[", 
             RowBox[{"panel", ",", 
              RowBox[{"Uncompress", "[", "data", "]"}]}], "]"}], ",", 
            "\"\<;\>\""}], "}"}], "]"}]}], ",", "\"\<Input\>\"", ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"prevent", " ", "deletion", " ", "by", " ", "Cell"}], ">", 
          RowBox[{"Delete", " ", "All", " ", 
           RowBox[{"Output", ":"}]}]}], "*)"}], 
        RowBox[{"GeneratedCell", "\[Rule]", "False"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"CellLabel", " ", "is", " ", 
           RowBox[{"special", ":", 
            RowBox[{
            "last", " ", "occrrence", " ", "takes", " ", "precedence"}]}]}], 
          ",", 
          RowBox[{"so", " ", "it", " ", "comes", " ", "before", " ", 
           RowBox[{"opt", ":"}]}]}], "*)"}], 
        RowBox[{"CellLabel", "\[Rule]", "\"\<(saved)\>\""}], ",", "opt", ",", 
        
        RowBox[{"CellLabelAutoDelete", "\[Rule]", "False"}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AllToCell", "[", 
    RowBox[{
     RowBox[{"name", ":", 
      RowBox[{"Except", "[", 
       RowBox[{"_", "?", "OptionQ"}], "]"}], ":", "\"\<data\>\""}], ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Compress", "[", "\"\<Global`*\>\"", "]"}]}], ",", 
       RowBox[{"panel", "=", 
        RowBox[{"ToBoxes", "@", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Panel", "[", 
            RowBox[{"name", ",", 
             RowBox[{"FrameMargins", "\[Rule]", "Small"}]}], "]"}], ",", 
           RowBox[{"DateString", "[", "]"}]}], "]"}]}]}]}], "}"}], ",", 
     RowBox[{"CellPrint", "@", 
      RowBox[{"Cell", "[", 
       RowBox[{
        RowBox[{"BoxData", "@", 
         RowBox[{"RowBox", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"MakeBoxes", "[", 
             RowBox[{"Names", "[", "\"\<Global`*\>\"", "]"}], "]"}], ",", 
            "\"\<=\>\"", ",", 
            RowBox[{"InterpretationBox", "[", 
             RowBox[{"panel", ",", 
              RowBox[{"Uncompress", "[", "data", "]"}]}], "]"}], ",", 
            "\"\<;\>\""}], "}"}], "]"}]}], ",", "\"\<Input\>\"", ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"prevent", " ", "deletion", " ", "by", " ", "Cell"}], ">", 
          RowBox[{"Delete", " ", "All", " ", 
           RowBox[{"Output", ":"}]}]}], "*)"}], 
        RowBox[{"GeneratedCell", "\[Rule]", "False"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"CellLabel", " ", "is", " ", 
           RowBox[{"special", ":", 
            RowBox[{
            "last", " ", "occrrence", " ", "takes", " ", "precedence"}]}]}], 
          ",", 
          RowBox[{"so", " ", "it", " ", "comes", " ", "before", " ", 
           RowBox[{"opt", ":"}]}]}], "*)"}], 
        RowBox[{"CellLabel", "\[Rule]", "\"\<(saved)\>\""}], ",", "opt", ",", 
        
        RowBox[{"CellLabelAutoDelete", "\[Rule]", "False"}]}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SaveAll", "[", 
    RowBox[{"fileName_String:", " ", "\"\<Data\>\""}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DumpSave", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"NotebookDirectory", "[", "]"}], "<>", "fileName", "<>", 
        "\"\<.mx\>\""}], ",", "\"\<Global`\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", 
      "\"\<All variables have been saved, which can be loaded by typing:\>\"",
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"\"\<<<\\\"\>\"", "<>", 
      RowBox[{"NotebookDirectory", "[", "]"}], "<>", "fileName", "<>", 
      "\"\<.mx\\\"\>\""}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PlotXY0", "[", "x__", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"narg", ",", 
      RowBox[{"x2", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"x3", "=", 
       RowBox[{"List", "[", "x", "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"narg", "=", 
      RowBox[{"Length", "[", "x3", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OddQ", "[", "narg", "]"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<X,Y should be paired\>\"", "]"}], ";", 
        "Return"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"AppendTo", "[", 
        RowBox[{"x2", ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x3", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"2", " ", "i"}], "-", "1"}], "]"}], "]"}], ",", 
            RowBox[{"x3", "[", 
             RowBox[{"[", 
              RowBox[{"2", " ", "i"}], "]"}], "]"}]}], "}"}], 
          "\[Transpose]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"narg", "/", "2"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ListLinePlot", "[", 
      RowBox[{"x2", ",", 
       RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"Mesh", "\[Rule]", "None"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotXY1", "[", "x__", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"narg", ",", 
       RowBox[{"x2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"x3", "=", 
        RowBox[{"List", "[", "x", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"narg", "=", 
       RowBox[{"Length", "[", "x3", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OddQ", "[", "narg", "]"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<X,Y should be paired\>\"", "]"}], ";", 
         "Return"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"x2", ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x3", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"2", " ", "i"}], "-", "1"}], "]"}], "]"}], ",", 
             RowBox[{"x3", "[", 
              RowBox[{"[", 
               RowBox[{"2", " ", "i"}], "]"}], "]"}]}], "}"}], 
           "\[Transpose]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"narg", "/", "2"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ListLinePlot", "[", 
       RowBox[{"x2", ",", 
        RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"AxesLabel", "\[Rule]", "axesLabel"}], ",", 
        RowBox[{"Mesh", "\[Rule]", "All"}]}], "]"}]}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotXYL", "[", "x__", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"narg", ",", 
       RowBox[{"x2", "=", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"x3", "=", 
        RowBox[{"List", "[", "x", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"narg", "=", 
       RowBox[{"Length", "[", "x3", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{"narg", ",", "3"}], "]"}], "\[NotEqual]", "0"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<X,Y should be paired\>\"", "]"}], ";", 
         "Return"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"x2", ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x3", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"3", " ", "i"}], "-", "2"}], "]"}], "]"}], ",", 
             RowBox[{"x3", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"3", " ", "i"}], "-", "1"}], "]"}], "]"}]}], "}"}], 
           "\[Transpose]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"narg", "/", "3"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", "x2", "]"}], ";"}], "*)"}], 
      RowBox[{"ListLinePlot", "[", 
       RowBox[{"x2", ",", 
        RowBox[{"PlotLegends", "\[Rule]", 
         RowBox[{"x3", "[", 
          RowBox[{"[", 
           RowBox[{"3", ";;", 
            RowBox[{"-", "1"}], ";;", "3"}], "]"}], "]"}]}], ",", 
        RowBox[{"AxesLabel", "\[Rule]", "axesLabel"}], ",", 
        RowBox[{"PlotMarkers", "\[Rule]", "None"}], ",", 
        RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
        RowBox[{"AxesOrigin", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Min", "[", 
            RowBox[{"x2", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{"x2", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}]}], 
          "}"}]}]}], "]"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"axesLabel", "=", 
   RowBox[{"{", 
    RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\""}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Needs", "[", "\"\<NDSolve`FEM`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Round1", "[", 
    RowBox[{"x_", ",", 
     RowBox[{"n_:", " ", "3"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "m", "}"}], ",", 
     RowBox[{
      RowBox[{"m", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"x", "\[Equal]", "0."}], ",", "0.", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"Log10", "[", 
           RowBox[{"Abs", "[", "x", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Round", "[", 
        RowBox[{"x", " ", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"n", "-", "m"}], ")"}]}]}], "]"}], " ", 
       RowBox[{"10.", "^", 
        RowBox[{"(", 
         RowBox[{"m", "-", "n"}], ")"}]}]}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContourLevel", "[", 
    RowBox[{"a_List", ",", 
     RowBox[{"nl_:", " ", "5"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ia", "=", 
        RowBox[{"Round1", "[", 
         RowBox[{"0.98", " ", 
          RowBox[{"Min", "[", "a", "]"}]}], "]"}]}], ",", 
       RowBox[{"xa", "=", 
        RowBox[{"Round1", "[", 
         RowBox[{"1.02", " ", 
          RowBox[{"Max", "[", "a", "]"}]}], "]"}]}], ",", "xr", ",", "mm"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"xr", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"ia", ",", "xa", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"xa", "-", "ia"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nl", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
      RowBox[{"mm", "=", 
       RowBox[{
        RowBox[{"10.", "^", 
         RowBox[{"-", "6"}]}], "*", 
        RowBox[{"Max", "[", 
         RowBox[{"Abs", "[", "xr", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xr", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"Chop", "[", 
          RowBox[{
           RowBox[{"Round1", "[", 
            RowBox[{"xr", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "mm"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "xr", "]"}]}], "}"}]}], "]"}], ";", "xr"}]}],
     "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Contour2DField", "[", 
    RowBox[{"sol_List", ",", "mesh_ElementMesh", ",", 
     RowBox[{"nint_:", " ", "5"}], ",", 
     RowBox[{"cLabel_:", " ", "True"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ufun", ",", "crange", ",", "smin", ",", "smax"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ufun", "=", 
       RowBox[{"ElementMeshInterpolation", "[", 
        RowBox[{
         RowBox[{"{", "mesh", "}"}], ",", "sol"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"smin", "=", 
         RowBox[{"Min", "[", "sol", "]"}]}], ";", 
        RowBox[{"smax", "=", 
         RowBox[{"Max", "[", "sol", "]"}]}], ";", 
        RowBox[{"crange", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"smin", ",", "smax", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"smax", "-", "smin"}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"nint", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xxx", "=", "crange"}], ";"}], "*)"}], 
      RowBox[{"ContourPlot", "[", 
       RowBox[{
        RowBox[{"ufun", "[", 
         RowBox[{"x", ",", "y"}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "y"}], "}"}], "\[Element]", "mesh"}], ",", 
        RowBox[{"ColorFunction", "\[Rule]", "\"\<Temperature\>\""}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
        RowBox[{"ContourLabels", "\[Rule]", "cLabel"}], ",", 
        RowBox[{"Contours", "\[Rule]", "nint"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContourListField", "[", 
    RowBox[{"sol_List", ",", "coord_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "sol", "]"}], ",", 
           RowBox[{"ndim", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], "=", "coord"}], ";", 
      RowBox[{
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], "=", "sol"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ndim", "\[Equal]", "2"}], ",", 
        RowBox[{"ListContourPlot", "[", 
         RowBox[{"data", ",", 
          RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
          RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
          RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}], ",", 
        RowBox[{"ListContourPlot3D", "[", 
         RowBox[{"data", ",", 
          RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
          RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
          RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]}], 
       "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.778689536341425*^9, 3.778689536342847*^9}, {
   3.778903722013042*^9, 3.7789037224773407`*^9}, {3.778905510212921*^9, 
   3.778905551417218*^9}, {3.778906089148395*^9, 3.778906142994416*^9}, {
   3.778906201391512*^9, 3.778906237196409*^9}, {3.778906300012845*^9, 
   3.7789063054264593`*^9}, {3.778906339769096*^9, 3.778906341742504*^9}, {
   3.778906524647813*^9, 3.778906533418953*^9}, 3.778906698182908*^9, {
   3.778907054544429*^9, 3.778907259748434*^9}, {3.778907328771803*^9, 
   3.778907353227172*^9}, {3.778907432764901*^9, 3.7789074430477943`*^9}, {
   3.7789075164068947`*^9, 3.778907564534697*^9}, {3.778907599064658*^9, 
   3.778907657645419*^9}, {3.778909288599869*^9, 3.778909297099051*^9}, {
   3.778909468436286*^9, 3.778909468626945*^9}, {3.778932806740527*^9, 
   3.7789328169476423`*^9}, {3.778933187434719*^9, 3.778933245566059*^9}, {
   3.778933277293787*^9, 3.778933310905182*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"d7a3a8f6-2538-48dc-81e4-95405381f418"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions for NOM with explicit phase field", "Section",
 CellChangeTimes->{{3.8373987537283683`*^9, 
  3.837398806469226*^9}},ExpressionUUID->"f915bbee-d71b-4b1e-b884-\
78c387c96393"],

Cell["\<\
This section contains the functions for NOM and the functions for explicit \
phase field. The functions in explicit NOM is very similar to the \
dual-horizon non-ordinary state-based peridynamics.\
\>", "Text",
 CellChangeTimes->{{3.837398809197545*^9, 
  3.8373988823403*^9}},ExpressionUUID->"10dd2d65-e7c2-4b9c-a1f9-dd231c5c1ce3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"The", " ", "inverse", " ", "of", " ", "shape", " ", "function"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Kmatrix", "[", 
     RowBox[{"coordi_List", ",", "WeiF_", ",", "voli_List"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"num", "=", 
         RowBox[{"Length", "[", "coordi", "]"}]}], ",", 
        RowBox[{"ndim", "=", 
         RowBox[{"Length", "[", 
          RowBox[{"coordi", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "kmat", ",", "vw", 
        ",", "xi", ",", "ri"}], "}"}], ",", 
      RowBox[{
       RowBox[{"kmat", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"ndim", ",", "ndim"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"xi", "=", 
           RowBox[{
            RowBox[{"coordi", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "-", 
            RowBox[{"coordi", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
          RowBox[{"ri", "=", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"xi", ".", "xi"}], "]"}]}], ";", 
          RowBox[{"vw", "=", 
           RowBox[{
            RowBox[{"voli", "[", 
             RowBox[{"[", "j", "]"}], "]"}], " ", 
            RowBox[{"WeiF", "[", "ri", "]"}]}]}], ";", 
          RowBox[{"kmat", "+=", 
           RowBox[{"vw", " ", 
            RowBox[{"TensorProduct", "[", 
             RowBox[{"xi", ",", "xi"}], "]"}]}]}], ";"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "2", ",", "num"}], "}"}]}], "]"}], ";", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Tr", "[", "kmat", "]"}], ",", 
         RowBox[{"Inverse", "[", "kmat", "]"}]}], "}"}]}]}], "]"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.837398898933507*^9, 3.8373989203370857`*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"c07596a4-50c9-42b4-93b2-78411a2b5639"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Compiled", " ", "version"}], ",", " ", 
    RowBox[{"which", " ", "is", " ", "much", " ", 
     RowBox[{"faster", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"KmatrixC", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"coordi", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"WeiF", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"voli", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"num", "=", 
            RowBox[{"Length", "[", "coordi", "]"}]}], ",", 
           RowBox[{"ndim", "=", 
            RowBox[{"Length", "[", 
             RowBox[{"coordi", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "kmat", ",", "vw",
            ",", "xi", ",", "ri", ",", 
           RowBox[{"ik$det", "=", "0."}], ",", 
           RowBox[{"k$11", "=", "0."}], ",", 
           RowBox[{"k$12", "=", "0."}], ",", 
           RowBox[{"k$21", "=", "0."}], ",", 
           RowBox[{"k$22", "=", "0."}], ",", 
           RowBox[{"k$13", "=", "0."}], ",", 
           RowBox[{"k$31", "=", "0."}], ",", 
           RowBox[{"k$23", "=", "0."}], ",", 
           RowBox[{"k$32", "=", "0."}], ",", 
           RowBox[{"k$33", "=", "0."}], ",", "invkv"}], "}"}], ",", 
         RowBox[{
          RowBox[{"kmat", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", "ndim", "}"}], ",", 
             RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"invkv", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", 
              RowBox[{"1", "+", 
               RowBox[{"ndim", " ", "ndim"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"xi", "=", 
              RowBox[{
               RowBox[{"coordi", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"coordi", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             RowBox[{"vw", "=", 
              RowBox[{
               RowBox[{"voli", "[", 
                RowBox[{"[", "j", "]"}], "]"}], " ", 
               RowBox[{"WeiF", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"kmat", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "jj"}], "]"}], "]"}], "+=", 
                RowBox[{"vw", " ", 
                 RowBox[{"xi", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", 
                 RowBox[{"xi", "[", 
                  RowBox[{"[", "jj", "]"}], "]"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "ndim"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"jj", ",", "ndim"}], "}"}]}], "]"}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2", ",", "num"}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"k$11", "=", 
           RowBox[{"kmat", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
          RowBox[{"k$22", "=", 
           RowBox[{"kmat", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", 
          RowBox[{"k$12", "=", 
           RowBox[{"kmat", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"k$21", "=", 
           RowBox[{"kmat", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ndim", "\[Equal]", "3"}], ",", 
            RowBox[{
             RowBox[{"k$13", "=", 
              RowBox[{"kmat", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ";", 
             RowBox[{"k$31", "=", 
              RowBox[{"kmat", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "1"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"k$23", "=", 
              RowBox[{"kmat", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ";", 
             RowBox[{"k$32", "=", 
              RowBox[{"kmat", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "2"}], "]"}], "]"}]}], ";", 
             RowBox[{"k$33", "=", 
              RowBox[{"kmat", "[", 
               RowBox[{"[", 
                RowBox[{"3", ",", "3"}], "]"}], "]"}]}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ndim", "\[Equal]", "2"}], ",", 
            RowBox[{"ik$det", "=", 
             RowBox[{"1.", "/", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "k$12"}], " ", "k$21"}], "+", 
                RowBox[{"k$11", " ", "k$22"}]}], ")"}]}]}], ",", 
            RowBox[{"ik$det", "=", 
             RowBox[{"1.", "/", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "k$13"}], " ", "k$22", " ", "k$31"}], "+", 
                RowBox[{"k$12", " ", "k$23", " ", "k$31"}], "+", 
                RowBox[{"k$13", " ", "k$21", " ", "k$32"}], "-", 
                RowBox[{"k$11", " ", "k$23", " ", "k$32"}], "-", 
                RowBox[{"k$12", " ", "k$21", " ", "k$33"}], "+", 
                RowBox[{"k$11", " ", "k$22", " ", "k$33"}]}], ")"}]}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ndim", "\[Equal]", "2"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"invkv", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "=", 
              RowBox[{"k$11", "+", "k$22"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"invkv", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "=", 
              RowBox[{"ik$det", " ", 
               RowBox[{"{", 
                RowBox[{"k$22", ",", 
                 RowBox[{"-", "k$12"}], ",", 
                 RowBox[{"-", "k$21"}], ",", "k$11"}], "}"}]}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"invkv", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "=", 
              RowBox[{"k$11", "+", "k$22", "+", "k$33"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"invkv", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "=", 
              RowBox[{"ik$det", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "k$23"}], " ", "k$32"}], "+", 
                  RowBox[{"k$22", " ", "k$33"}]}], ",", 
                 RowBox[{
                  RowBox[{"k$13", " ", "k$32"}], "-", 
                  RowBox[{"k$12", " ", "k$33"}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "k$13"}], " ", "k$22"}], "+", 
                  RowBox[{"k$12", " ", "k$23"}]}], ",", 
                 RowBox[{
                  RowBox[{"k$23", " ", "k$31"}], "-", 
                  RowBox[{"k$21", " ", "k$33"}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "k$13"}], " ", "k$31"}], "+", 
                  RowBox[{"k$11", " ", "k$33"}]}], ",", 
                 RowBox[{
                  RowBox[{"k$13", " ", "k$21"}], "-", 
                  RowBox[{"k$11", " ", "k$23"}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "k$22"}], " ", "k$31"}], "+", 
                  RowBox[{"k$21", " ", "k$32"}]}], ",", 
                 RowBox[{
                  RowBox[{"k$12", " ", "k$31"}], "-", 
                  RowBox[{"k$11", " ", "k$32"}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "k$12"}], " ", "k$21"}], "+", 
                  RowBox[{"k$11", " ", "k$22"}]}]}], "}"}]}]}]}]}], "]"}], 
          ";", "\[IndentingNewLine]", "invkv"}]}], "]"}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"RuntimeOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], 
         "}"}]}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"KmatrixL", "[", 
      RowBox[{"neicoord_", ",", "neiWeiL_", ",", "neivol_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res1", ",", "trk", ",", 
         RowBox[{"num", "=", 
          RowBox[{"Length", "[", "neicoord", "]"}]}], ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"neicoord", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], ",", "invk", ",",
          "x1"}], "}"}], ",", 
       RowBox[{
        RowBox[{"res1", "=", 
         RowBox[{"KmatrixC", "[", 
          RowBox[{"neicoord", ",", "neiWeiL", ",", "neivol"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"trk", "=", 
         RowBox[{"res1", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
        RowBox[{"invk", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", 
            RowBox[{"num", ",", "ndim", ",", "ndim"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"x1", "=", 
            RowBox[{"res1", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", 
               RowBox[{"2", ";;"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"invk", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"ArrayReshape", "[", 
             RowBox[{"x1", ",", 
              RowBox[{"{", 
               RowBox[{"ndim", ",", "ndim"}], "}"}]}], "]"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", 
        RowBox[{"{", 
         RowBox[{"trk", ",", "invk"}], "}"}]}]}], "]"}]}], ";"}]}]}]], "Input",\

 CellChangeTimes->{{3.778391765274599*^9, 3.7783918442191143`*^9}, {
   3.7783918865675364`*^9, 3.778391894441987*^9}, {3.778392282362175*^9, 
   3.778392670977402*^9}, {3.778392782785797*^9, 3.7783927834798365`*^9}, {
   3.778392887173768*^9, 3.7783928955462465`*^9}, {3.7783929582438326`*^9, 
   3.7783930984018497`*^9}, {3.7783937967667933`*^9, 
   3.7783941386953506`*^9}, {3.7783944623978653`*^9, 
   3.7783945928193254`*^9}, {3.7783946650634575`*^9, 
   3.7783946761680927`*^9}, {3.778394736895566*^9, 3.7783948544822917`*^9}, {
   3.7783950582189445`*^9, 3.778395111801009*^9}, {3.7783951681732335`*^9, 
   3.778395193624689*^9}, {3.77839533297766*^9, 3.778395342289192*^9}, {
   3.778395384879628*^9, 3.778395412632216*^9}, 3.778395461196994*^9, {
   3.7783955627418013`*^9, 3.778395576288576*^9}, 3.7802295701777363`*^9, 
   3.780316210449443*^9, {3.837398932235367*^9, 3.837398941358117*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"aa2d0b77-8534-4cbb-af29-bd5c45b4f2d3"],

Cell[BoxData[
 RowBox[{"<<", "CompiledFunctionTools`"}]], "Input",
 CellLabel->"In[86]:=",ExpressionUUID->"7451df64-a3cc-4281-adaa-4ee03f2ecc31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"FSmatrixC", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"pf", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"uvwi", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"coordi", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"voli", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"invK", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"WeiL", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"num", "=", 
            RowBox[{"Length", "[", "coordi", "]"}]}], ",", 
           RowBox[{"ndim", "=", 
            RowBox[{"Length", "[", 
             RowBox[{"coordi", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "fmat", ",", 
           "pfv", ",", "vw", ",", "xi", ",", "ri", ",", "ui", ",", "pfi", ",",
            "res"}], "}"}], ",", 
         RowBox[{
          RowBox[{"fmat", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", "ndim", "}"}], ",", 
             RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"pfv", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
          RowBox[{"res", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"ndim", " ", "ndim"}], "+", "ndim"}], "}"}]}], "]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"xi", "=", 
              RowBox[{
               RowBox[{"coordi", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"coordi", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             RowBox[{"ui", "=", 
              RowBox[{
               RowBox[{"uvwi", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"uvwi", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"pfi", "=", 
              RowBox[{
               RowBox[{"pf", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"pf", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             RowBox[{"vw", "=", 
              RowBox[{
               RowBox[{"voli", "[", 
                RowBox[{"[", "j", "]"}], "]"}], " ", 
               RowBox[{"WeiL", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}]}], ";", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"fmat", "+=", 
                RowBox[{"vw", " ", 
                 RowBox[{"TensorProduct", "[", 
                  RowBox[{"ui", ",", "xi"}], "]"}]}]}], ";"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"fmat", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "+=", 
                RowBox[{"vw", " ", 
                 RowBox[{"ui", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", 
                 RowBox[{"xi", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "ndim"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "ndim"}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"pfv", "+=", 
              RowBox[{"vw", " ", "pfi", " ", "xi"}]}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2", ",", "num"}], "}"}]}], "]"}], ";", 
          RowBox[{"fmat", "=", 
           RowBox[{"fmat", ".", "invK"}]}], ";", 
          RowBox[{"pfv", "=", 
           RowBox[{"invK", ".", "pfv"}]}], ";", 
          RowBox[{
           RowBox[{"res", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "ndim"}], "]"}], "]"}], "=", "pfv"}], ";", 
          RowBox[{
           RowBox[{"res", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"ndim", "+", "1"}], ";;", 
              RowBox[{"-", "1"}]}], "]"}], "]"}], "=", 
           RowBox[{"Flatten", "[", "fmat", "]"}]}], ";", "res"}]}], "]"}], 
       ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"RuntimeOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], 
         "}"}]}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FSmatrixL", "[", 
      RowBox[{
      "neipfList_", ",", "neicoord_", ",", "neicoord0_", ",", "neivol_", ",", 
       "invKList_", ",", "neiWeiL_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res", ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"neicoord", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"res", "=", 
         RowBox[{"FSmatrixC", "[", 
          RowBox[{
          "neipfList", ",", "neicoord", ",", "neicoord0", ",", "neivol", ",", 
           "invKList", ",", "neiWeiL"}], "]"}]}], ";", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], ",", 
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{"ndim", "+", "1"}], ";;", 
              RowBox[{"-", "1"}]}]}], "]"}], "]"}]}], "}"}]}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FSmatrixC2", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"pf", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"uvwi", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"coordi", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"voli", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"invK", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"WeiL", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"num", "=", 
            RowBox[{"Length", "[", "coordi", "]"}]}], ",", 
           RowBox[{"ndim", "=", 
            RowBox[{"Length", "[", 
             RowBox[{"coordi", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "fmat", ",", 
           "pfv", ",", "vw", ",", "xi", ",", "ri", ",", "ui", ",", "pfi", ",",
            "res"}], "}"}], ",", 
         RowBox[{
          RowBox[{"fmat", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", "ndim", "}"}], ",", 
             RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"pfv", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
          RowBox[{"res", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"ndim", " ", "ndim"}], "+", "ndim"}], "}"}]}], "]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"xi", "=", 
              RowBox[{
               RowBox[{"coordi", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"coordi", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             RowBox[{"ui", "=", 
              RowBox[{
               RowBox[{"uvwi", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"uvwi", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"pfi", "=", 
              RowBox[{
               RowBox[{"pf", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"pf", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             RowBox[{"vw", "=", 
              RowBox[{
               RowBox[{"voli", "[", 
                RowBox[{"[", "j", "]"}], "]"}], " ", 
               RowBox[{"WeiL", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}]}], ";", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"fmat", "+=", 
                RowBox[{"vw", " ", 
                 RowBox[{"TensorProduct", "[", 
                  RowBox[{"ui", ",", "xi"}], "]"}]}]}], ";"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"fmat", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "+=", 
                RowBox[{"vw", " ", 
                 RowBox[{"ui", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", 
                 RowBox[{"xi", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "ndim"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "ndim"}], "}"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"pfv", "+=", 
              RowBox[{"vw", " ", "pfi", " ", "xi"}]}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2", ",", "num"}], "}"}]}], "]"}], ";", 
          RowBox[{"fmat", "=", 
           RowBox[{"fmat", ".", "invK"}]}], ";", 
          RowBox[{"pfv", "=", 
           RowBox[{"invK", ".", "pfv"}]}], ";", 
          RowBox[{
           RowBox[{"res", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "ndim"}], "]"}], "]"}], "=", "pfv"}], ";", 
          RowBox[{
           RowBox[{"res", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"ndim", "+", "1"}], ";;", 
              RowBox[{"-", "1"}]}], "]"}], "]"}], "=", 
           RowBox[{"Flatten", "[", "fmat", "]"}]}], ";", "res"}]}], "]"}], 
       ",", 
       RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"RuntimeOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], 
         "}"}]}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FSmatrixL2", "[", 
      RowBox[{
      "neipfList_", ",", "neicoord_", ",", "neicoord0_", ",", "neivol_", ",", 
       "invKList_", ",", "neiWeiL_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res", ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"neicoord", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"res", "=", 
         RowBox[{"FSmatrixC2", "[", 
          RowBox[{
          "neipfList", ",", "neicoord", ",", "neicoord0", ",", "neivol", ",", 
           "invKList", ",", "neiWeiL"}], "]"}]}], ";", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "ndim"}]}], "]"}], "]"}], ",", 
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{"ndim", "+", "1"}], ";;", 
              RowBox[{"-", "1"}]}]}], "]"}], "]"}]}], "}"}]}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GradSmatrixC", "=", 
     RowBox[{"Compile", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"pf", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"coordi", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"voli", ",", "_Real", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"invK", ",", "_Real", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"WeiL", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"num", "=", 
            RowBox[{"Length", "[", "coordi", "]"}]}], ",", 
           RowBox[{"ndim", "=", 
            RowBox[{"Length", "[", 
             RowBox[{"coordi", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "pfv", ",", "vw", 
           ",", "xi", ",", "ri", ",", "ui", ",", "pfi"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"pfv", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.", ",", 
             RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"xi", "=", 
              RowBox[{
               RowBox[{"coordi", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"coordi", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"pfi", "=", 
              RowBox[{
               RowBox[{"pf", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"pf", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             RowBox[{"vw", "=", 
              RowBox[{
               RowBox[{"voli", "[", 
                RowBox[{"[", "j", "]"}], "]"}], " ", 
               RowBox[{"WeiL", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}]}], ";", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"fmat", "+=", 
                RowBox[{"vw", " ", 
                 RowBox[{"TensorProduct", "[", 
                  RowBox[{"ui", ",", "xi"}], "]"}]}]}], ";"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"pfv", "+=", 
              RowBox[{"vw", " ", "pfi", " ", "xi"}]}], ";"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2", ",", "num"}], "}"}]}], "]"}], ";", 
          RowBox[{"invK", ".", "pfv"}]}]}], "]"}], ",", 
       RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", 
       RowBox[{"RuntimeOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], 
         "}"}]}], ",", 
       RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"GradSmatrixL", "[", 
      RowBox[{
      "neipfList_", ",", "neicoord0_", ",", "neivol_", ",", "invKList_", ",", 
       "neiWeiL_"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res", ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"neicoord0", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"res", "=", 
         RowBox[{"GradSmatrixC", "[", 
          RowBox[{
          "neipfList", ",", "neicoord0", ",", "neivol", ",", "invKList", ",", 
           "neiWeiL"}], "]"}]}], ";", "res"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"StressDecompositionPFC", "=", 
      RowBox[{"Compile", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ndim", ",", "_Integer"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"bulkK", ",", "_Real"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"shearG", ",", "_Real"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gcl0", ",", "_Real"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"fmat2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "fmat", ",", "emat", ",", "ematD", ",", "el", ",", "ev", ",", 
            RowBox[{"elsum", "=", "0."}], ",", 
            RowBox[{"esp", "=", "0."}], ",", 
            RowBox[{"esn", "=", "0."}], ",", 
            RowBox[{"e1p", "=", "0."}], ",", 
            RowBox[{"e1n", "=", "0."}], ",", 
            RowBox[{"e2p", "=", "0."}], ",", 
            RowBox[{"e2n", "=", "0."}], ",", 
            RowBox[{"e3p", "=", "0."}], ",", 
            RowBox[{"e3n", "=", "0."}], ",", "n11", ",", "n22", ",", "n33", 
            ",", 
            RowBox[{"enerP", "=", "0."}], ",", 
            RowBox[{"enerN", "=", "0."}], ",", 
            RowBox[{"ener", "=", "0."}], ",", "se", ",", "sep", ",", " ", 
            "a$10", ",", "b$10", ",", "c$10", ",", "d$10", ",", "e$10", ",", 
            "f$10", ",", "dn$10", ",", "dd$10", ",", "cc$10", ",", "bb$10", 
            ",", "d1$10", ",", "d$101", ",", 
            RowBox[{"C$10", "=", 
             RowBox[{"0", "*", "I"}]}], ",", "x123$10", ",", "x1$10", ",", 
            "x2$10", ",", "x3$10", ",", "v1$10", ",", "v2$10", ",", "v3$10", 
            ",", 
            RowBox[{"tol$10", "=", 
             RowBox[{"10.", "^", 
              RowBox[{"-", "24"}]}]}], ",", 
            RowBox[{"(*", 
             RowBox[{
             "tol$10", " ", "should", " ", "be", " ", "very", " ", "small"}], 
             "*)"}], "res", ",", "ires"}], "}"}], ",", 
          RowBox[{
           RowBox[{"fmat", "=", 
            RowBox[{"Table", "[", 
             RowBox[{"0.", ",", 
              RowBox[{"{", "ndim", "}"}], ",", 
              RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"fmat", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "=", 
              RowBox[{"fmat2", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "ndim"}], "+", "1"}], ";;", 
                 RowBox[{"i", " ", "ndim"}]}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"emat", "=", 
            RowBox[{"0.5", 
             RowBox[{"(", 
              RowBox[{"fmat", "+", 
               RowBox[{"fmat", "\[Transpose]"}]}], ")"}]}]}], ";", 
           RowBox[{"res", "=", 
            RowBox[{"Table", "[", 
             RowBox[{"0.", ",", 
              RowBox[{"{", 
               RowBox[{"2", "+", 
                RowBox[{"2", 
                 RowBox[{"ndim", "^", "2"}]}]}], "}"}]}], "]"}]}], ";", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"emat", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "i"}], "]"}], "]"}], "-=", "1."}], ";"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"elsum", "+=", 
              RowBox[{"emat", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "i"}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"se", "=", 
            RowBox[{"shearG", " ", "emat"}]}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"+", 
              RowBox[{"(", 
               RowBox[{"bulkK", " ", "elsum"}], ")"}]}], 
             RowBox[{"IdentityMatrix", "[", "ndim", "]"}]}], "*)"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"se", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "i"}], "]"}], "]"}], "+=", 
              RowBox[{"elsum", " ", "bulkK"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"enerP", "+=", 
              RowBox[{
               RowBox[{"se", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", 
               RowBox[{"emat", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "ndim"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "ndim"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"enerP", "*=", "0.5"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"res", "[", 
               RowBox[{"[", 
                RowBox[{"2", "+", 
                 RowBox[{"ndim", " ", 
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}]}], "+", "j"}], "]"}], "]"}],
               "=", 
              RowBox[{"se", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "ndim"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"enerP", "<", "gcl0"}], ",", 
             RowBox[{"Return", "[", "res", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"sep", "=", 
            RowBox[{"Table", "[", 
             RowBox[{"0.", ",", 
              RowBox[{"{", "ndim", "}"}], ",", 
              RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"ndim", "\[Equal]", "2"}], ",", 
             RowBox[{
              RowBox[{"ematD", "=", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{"4", " ", 
                  RowBox[{
                   RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], "-", 
                 
                 RowBox[{"2", " ", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
                 RowBox[{
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                "]"}]}], ";", 
              RowBox[{"el", "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"0.5", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", "ematD"}], 
                   ")"}]}], ",", 
                 RowBox[{"0.5", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", "ematD"}], 
                   ")"}]}]}], "}"}]}], ";", 
              RowBox[{"ev", "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", "ematD", "+", 
                    
                    RowBox[{"10.", "^", 
                    RowBox[{"-", "30"}]}]}], ",", 
                    RowBox[{"2", " ", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "}"}], "/", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{
                    RowBox[{"10.", "^", 
                    RowBox[{"-", "60"}]}], "+", 
                    RowBox[{"4", " ", 
                    RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", "ematD"}], 
                    ")"}], "^", "2"}]}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", "ematD"}], 
                    ",", 
                    RowBox[{
                    RowBox[{"2", " ", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "+", 
                    RowBox[{"10.", "^", 
                    RowBox[{"-", "30"}]}]}]}], "}"}], "/", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{
                    RowBox[{"10.", "^", 
                    RowBox[{"-", "60"}]}], "+", 
                    RowBox[{"4", " ", 
                    RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", "ematD"}], 
                    ")"}], "^", "2"}]}], "]"}]}]}], "}"}]}], ";", 
              RowBox[{"elsum", "=", 
               RowBox[{
                RowBox[{"el", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", 
                RowBox[{"el", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}]}], ";", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"elsum", ">", "0."}], ",", 
                RowBox[{"esp", "=", "elsum"}], ",", 
                RowBox[{"esn", "=", "elsum"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"el", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ">", "0."}], ",", 
                RowBox[{"e1p", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                RowBox[{"e1n", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"el", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ">", "0."}], ",", 
                RowBox[{"e2p", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                RowBox[{"e2n", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"n11", "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                  "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"n22", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1.", ",", "0."}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", "1."}], "}"}]}], "}"}], "-", "n11"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"enerP", "=", 
               RowBox[{
                RowBox[{"0.5", "bulkK", " ", 
                 RowBox[{"esp", "^", "2"}]}], "+", 
                RowBox[{"0.5", " ", "shearG", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"e1p", "^", "2"}], "+", 
                   RowBox[{"e2p", "^", "2"}]}], ")"}]}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"enerN", "=", 
               RowBox[{
                RowBox[{"0.5", " ", "bulkK", " ", 
                 RowBox[{"esn", "^", "2"}]}], "+", 
                RowBox[{"0.5", "shearG", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"e1n", "^", "2"}], "+", 
                   RowBox[{"e2n", "^", "2"}]}], ")"}]}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"sep", "=", 
               RowBox[{
                RowBox[{"bulkK", " ", 
                 RowBox[{"(", "  ", "esp", ")"}], 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"1.", ",", "0."}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0.", ",", "1."}], "}"}]}], "}"}]}], "+", 
                RowBox[{"shearG", 
                 RowBox[{"(", " ", "e1p", ")"}], " ", "n11"}], "+", 
                RowBox[{"shearG", " ", 
                 RowBox[{"(", "e2p", ")"}], "n22"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"ndim", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"eigenvalue", " ", "eigenvector", " ", "for", " ", 
               RowBox[{"m33", ":", "begin"}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "a$10", ",", "b$10", ",", "c$10", ",", "d$10", ",", "e$10", 
                 ",", "f$10"}], "}"}], "=", 
               RowBox[{"Chop", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "}"}], "]"}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"dd$10", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"c$10", "^", "2"}], " ", "d$10"}], "-", 
                RowBox[{"2", " ", "b$10", " ", "c$10", " ", "e$10"}], "+", 
                RowBox[{"a$10", " ", 
                 RowBox[{"e$10", "^", "2"}]}], "+", 
                RowBox[{
                 RowBox[{"b$10", "^", "2"}], " ", "f$10"}], "-", 
                RowBox[{"a$10", " ", "d$10", " ", "f$10"}]}]}], ";", 
              RowBox[{"cc$10", "=", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{"b$10", "^", "2"}]}], "-", 
                 RowBox[{"c$10", "^", "2"}], "+", 
                 RowBox[{"a$10", " ", "d$10"}], "-", 
                 RowBox[{"e$10", "^", "2"}], "+", 
                 RowBox[{"a$10", " ", "f$10"}], "+", 
                 RowBox[{"d$10", " ", "f$10"}]}], ")"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"bb$10", "=", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"-", "a$10"}], "-", "d$10", "-", "f$10"}], ")"}]}], 
              ";", 
              RowBox[{"d1$10", "=", 
               RowBox[{
                RowBox[{"bb$10", "^", "2"}], "-", 
                RowBox[{"3", " ", "cc$10"}]}]}], ";", 
              RowBox[{"d$101", "=", 
               RowBox[{
                RowBox[{"2", " ", 
                 RowBox[{"bb$10", "^", "3"}]}], "-", 
                RowBox[{"9", " ", "bb$10", " ", "cc$10"}], "+", 
                RowBox[{"27", " ", "dd$10"}]}]}], ";", 
              RowBox[{"dn$10", "=", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"d$101", "^", "2"}], "-", 
                   RowBox[{"4", " ", 
                    RowBox[{"d1$10", "^", "3"}]}]}], ")"}]}], "/", "27"}]}], 
              ";", 
              RowBox[{"x123$10", "=", 
               RowBox[{"Re", "[", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Abs", "[", "dn$10", "]"}], "\[LessEqual]", 
                   "tol$10"}], ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", "d1$10", "]"}], "\[LessEqual]", 
                    "tol$10"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "bb$10"}], "/", "3."}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"0.5", " ", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"9", " ", "dd$10"}], "-", 
                    RowBox[{"bb$10", " ", "cc$10"}]}], ")"}], "/", 
                    "d1$10"}]}], ",", 
                    RowBox[{
                    RowBox[{"1.", "/", "d1$10"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"4", " ", "bb$10", " ", "cc$10"}], "-", 
                    RowBox[{"9", " ", "dd$10"}], "-", 
                    RowBox[{"bb$10", "^", "3"}]}], ")"}]}]}], "}"}]}], "]"}], 
                  ",", 
                  RowBox[{
                   RowBox[{"C$10", "=", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"0.5", " ", 
                    RowBox[{"(", 
                    RowBox[{"d$101", "+", 
                    RowBox[{"Sqrt", "[", 
                    RowBox[{
                    RowBox[{"-", "27"}], " ", "dn$10"}], "]"}]}], ")"}]}], 
                    ")"}], "^", 
                    RowBox[{"(", 
                    RowBox[{"1", "/", "3"}], ")"}]}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "1."}], "/", "3"}], " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"bb$10", "+", "C$10", "+", 
                    RowBox[{"d1$10", "/", "C$10"}]}], ",", 
                    RowBox[{"bb$10", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "0.5"}], "+", 
                    RowBox[{"0.5", " ", 
                    RowBox[{"Sqrt", "[", 
                    RowBox[{"-", "3"}], "]"}]}]}], ")"}], " ", "C$10"}], "+", 
                    
                    RowBox[{
                    RowBox[{"d1$10", "/", "C$10"}], "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "0.5"}], "+", 
                    RowBox[{"0.5", " ", 
                    RowBox[{"Sqrt", "[", 
                    RowBox[{"-", "3"}], "]"}]}]}], ")"}]}]}], ",", 
                    RowBox[{"bb$10", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "0.5"}], "-", 
                    RowBox[{"0.5", " ", 
                    RowBox[{"Sqrt", "[", 
                    RowBox[{"-", "3"}], "]"}]}]}], ")"}], " ", "C$10"}], "+", 
                    
                    RowBox[{
                    RowBox[{"d1$10", "/", "C$10"}], "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "0.5"}], "-", 
                    RowBox[{"0.5", " ", 
                    RowBox[{"Sqrt", "[", 
                    RowBox[{"-", "3"}], "]"}]}]}], ")"}]}]}]}], "}"}]}]}]}], 
                 "]"}], "]"}]}], ";", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"v1$10", ",", "v2$10", ",", "v3$10"}], "}"}], "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}]}], ";", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"x123$10", "=", 
                 RowBox[{"Re", "[", "x123$10", "]"}]}], ";"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"x1$10", "=", 
               RowBox[{"x123$10", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", 
              RowBox[{"x2$10", "=", "x1$10"}], ";", 
              RowBox[{"x3$10", "=", "x1$10"}], ";", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "x123$10", "]"}], "\[Equal]", "2"}], 
                ",", 
                RowBox[{
                 RowBox[{"x3$10", "=", 
                  RowBox[{"x123$10", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"v3$10", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"e$10", "^", "2"}]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"d$10", "-", "x3$10"}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"f$10", "-", "x3$10"}], ")"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"c$10", " ", "e$10"}], "+", 
                    RowBox[{"b$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "f$10"}], "+", "x3$10"}], ")"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"b$10", " ", "e$10"}], "+", 
                    RowBox[{"c$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "d$10"}], "+", "x3$10"}], ")"}]}]}]}], 
                   "}"}]}], ";", 
                 RowBox[{"v3$10", "*=", 
                  RowBox[{"1.", "/", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"v3$10", ".", "v3$10"}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"v2$10", "=", 
                  RowBox[{"v3$10", "+", 
                   RowBox[{"RandomReal", "[", 
                    RowBox[{"1.", ",", "3"}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"v2$10", "-=", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"v3$10", ".", "v2$10"}], ")"}], " ", "v3$10"}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"v2$10", "*=", 
                  RowBox[{"1.", "/", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"v2$10", ".", "v2$10"}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"v1$10", "=", 
                  RowBox[{"Cross", "[", 
                   RowBox[{"v2$10", ",", "v3$10"}], "]"}]}], ";"}]}], "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "x123$10", "]"}], "\[Equal]", "3"}], 
                ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"x1$10", ",", "x2$10", ",", "x3$10"}], "}"}], "=", 
                  "x123$10"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"v1$10", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"e$10", "^", "2"}]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"d$10", "-", "x1$10"}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"f$10", "-", "x1$10"}], ")"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"c$10", " ", "e$10"}], "+", 
                    RowBox[{"b$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "f$10"}], "+", "x1$10"}], ")"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"b$10", " ", "e$10"}], "+", 
                    RowBox[{"c$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "d$10"}], "+", "x1$10"}], ")"}]}]}]}], 
                   "}"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"v1$10", "*=", 
                  RowBox[{"1.", "/", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"v1$10", ".", "v1$10"}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"v2$10", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"e$10", "^", "2"}]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"d$10", "-", "x2$10"}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"f$10", "-", "x2$10"}], ")"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"c$10", " ", "e$10"}], "+", 
                    RowBox[{"b$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "f$10"}], "+", "x2$10"}], ")"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"b$10", " ", "e$10"}], "+", 
                    RowBox[{"c$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "d$10"}], "+", "x2$10"}], ")"}]}]}]}], 
                   "}"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"v2$10", "*=", 
                  RowBox[{"1.", "/", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"v2$10", ".", "v2$10"}], "]"}]}]}], ";", 
                 RowBox[{"v3$10", "=", 
                  RowBox[{"Cross", "[", 
                   RowBox[{"v1$10", ",", "v2$10"}], "]"}]}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"el", "=", 
               RowBox[{"{", 
                RowBox[{"x1$10", ",", "x2$10", ",", "x3$10"}], "}"}]}], ";", 
              RowBox[{"ev", "=", 
               RowBox[{"{", 
                RowBox[{"v1$10", ",", "v2$10", ",", "v3$10"}], "}"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"eigenvalue", " ", "eigenvector", " ", "for", " ", 
                RowBox[{"m33", ":", "end"}]}], "*)"}], "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"elsum", "=", 
               RowBox[{
                RowBox[{"el", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", 
                RowBox[{"el", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "+", 
                RowBox[{"el", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"elsum", ">", "0."}], ",", 
                RowBox[{"esp", "=", "elsum"}], ",", 
                RowBox[{"esn", "=", "elsum"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"el", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ">", "0."}], ",", 
                RowBox[{"e1p", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                RowBox[{"e1n", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"el", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ">", "0."}], ",", 
                RowBox[{"e2p", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                RowBox[{"e2n", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"el", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], ">", "0."}], ",", 
                RowBox[{"e3p", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], ",", 
                RowBox[{"e3n", "=", 
                 RowBox[{"el", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"enerP", "=", 
               RowBox[{
                RowBox[{"0.5", "bulkK", " ", 
                 RowBox[{"esp", "^", "2"}]}], "+", 
                RowBox[{"0.5", "shearG", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"e1p", "^", "2"}], "+", 
                   RowBox[{"e2p", "^", "2"}], "+", 
                   RowBox[{"e3p", "^", "2"}]}], ")"}]}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"enerN", "=", 
               RowBox[{
                RowBox[{"0.5", " ", "bulkK", " ", 
                 RowBox[{"esn", "^", "2"}]}], "+", 
                RowBox[{"0.5", "shearG", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"e1n", "^", "2"}], "+", 
                   RowBox[{"e2n", "^", "2"}], "+", 
                   RowBox[{"e3n", "^", "2"}]}], ")"}]}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"n11", "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                  "}"}]}], "\[IndentingNewLine]", "}"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"n22", "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"ev", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                  "}"}]}], "\[IndentingNewLine]", "}"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"n33", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}], "-", 
                "n11", "-", "n22"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"sep", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"bulkK", " ", "esp"}], ")"}], 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}]}], 
                "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"shearG", " ", "e1p"}], ")"}], " ", "n11"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"shearG", "  ", "e2p"}], ")"}], "n22"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"shearG", " ", "e3p"}], ")"}], "n33"}]}]}], ";"}]}],
             "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"ires", "=", 
            RowBox[{"2", "+", 
             RowBox[{"ndim", " ", "ndim"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"res", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "=", "enerP"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"res", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "=", "enerN"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"res", "[", 
               RowBox[{"[", 
                RowBox[{"ires", "+", 
                 RowBox[{"ndim", 
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}]}], "+", "j"}], "]"}], "]"}],
               "=", 
              RowBox[{"sep", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "ndim"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", "res"}]}], "]"}], ",", 
        RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
        RowBox[{"RuntimeAttributes", "\[Rule]", 
         RowBox[{"{", "Listable", "}"}]}], ",", 
        RowBox[{"RuntimeOptions", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], 
          "}"}]}], ",", 
        RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], ";"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"StressList", "[", 
      RowBox[{
      "ndim_", ",", "bulkK_", ",", "shearG_", ",", "gcl0_", ",", "fmat2_"}], 
      "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "res", "}"}], ",", 
       RowBox[{
        RowBox[{"res", "=", 
         RowBox[{"StressDecompositionPFC", "[", 
          RowBox[{
          "ndim", ",", "bulkK", ",", "shearG", ",", "gcl0", ",", "fmat2"}], 
          "]"}]}], ";", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"3", ";;", 
              RowBox[{
               RowBox[{"ndim", " ", "ndim"}], "+", "2"}]}]}], "]"}], "]"}], 
          ",", 
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"ndim", " ", "ndim"}], "+", "3"}], ";;", 
              RowBox[{"-", "1"}]}]}], "]"}], "]"}]}], "}"}]}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7783901548734894`*^9, 3.7783901643710327`*^9}, {
   3.7783902068904643`*^9, 3.778390215076933*^9}, {3.778390526114723*^9, 
   3.7783906779684086`*^9}, {3.7783907129044065`*^9, 
   3.7783907507485714`*^9}, {3.7783911410888977`*^9, 
   3.7783911456361575`*^9}, {3.778391477930164*^9, 3.778391492527999*^9}, {
   3.7783961388757544`*^9, 3.7783962798928204`*^9}, {3.778396355436141*^9, 
   3.7783963611604686`*^9}, {3.778396409719246*^9, 3.778396575328718*^9}, 
   3.778396671726232*^9, 3.7784154821229143`*^9, {3.7786527820605073`*^9, 
   3.778652989619379*^9}, {3.7786852334954243`*^9, 3.778685241315131*^9}, {
   3.778685312760941*^9, 3.778685316512704*^9}, {3.7786853585956783`*^9, 
   3.7786853586811113`*^9}, {3.778685423596587*^9, 3.778685482829711*^9}, {
   3.778685525387401*^9, 3.778685539687955*^9}, {3.7802305146865396`*^9, 
   3.7802305763755627`*^9}, {3.7802426794405518`*^9, 3.780242727151506*^9}, {
   3.780243523419345*^9, 3.780243555590929*^9}, {3.780245328237475*^9, 
   3.7802454020015078`*^9}, {3.7802455501560802`*^9, 3.78024555080441*^9}, {
   3.7802456697064257`*^9, 3.78024569835758*^9}, 3.780281371594452*^9, {
   3.7802815778174553`*^9, 3.780281593547127*^9}, {3.7802862241873903`*^9, 
   3.780286225143865*^9}, {3.780287264222497*^9, 3.780287272107581*^9}, {
   3.780485905485929*^9, 3.780485941930292*^9}, {3.780486141369474*^9, 
   3.7804861429094563`*^9}, {3.7804862568917923`*^9, 
   3.7804862577328663`*^9}, {3.837398987547988*^9, 3.8373989923442917`*^9}, {
   3.8374002209984584`*^9, 3.8374002341436253`*^9}},
 CellLabel->"In[87]:=",ExpressionUUID->"3c2174e2-cef8-433d-862e-c5db472794a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "stress", " ", "decomposition", " ", "based", " ", "on", " ", "Miehe", " ", 
    RowBox[{"paper", ".", " ", "Only"}], " ", "the", " ", "stress", " ", 
    "decomposition", " ", "of", " ", "strain", " ", "tensor"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"StressDecompositionPFC", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ndim", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"bulkK", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"shearG", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"gcl0", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"fmat2", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"fmat", ",", "emat", ",", "ematD", ",", "el", ",", "ev", ",", 
          RowBox[{"elsum", "=", "0."}], ",", 
          RowBox[{"esp", "=", "0."}], ",", 
          RowBox[{"esn", "=", "0."}], ",", 
          RowBox[{"e1p", "=", "0."}], ",", 
          RowBox[{"e1n", "=", "0."}], ",", 
          RowBox[{"e2p", "=", "0."}], ",", 
          RowBox[{"e2n", "=", "0."}], ",", 
          RowBox[{"e3p", "=", "0."}], ",", 
          RowBox[{"e3n", "=", "0."}], ",", "n11", ",", "n22", ",", "n33", ",", 
          RowBox[{"enerP", "=", "0."}], ",", 
          RowBox[{"enerN", "=", "0."}], ",", 
          RowBox[{"ener", "=", "0."}], ",", "se", ",", "sep", ",", " ", 
          "a$10", ",", "b$10", ",", "c$10", ",", "d$10", ",", "e$10", ",", 
          "f$10", ",", 
          RowBox[{"dn$10", "=", "0."}], ",", 
          RowBox[{"dd$10", "=", "0."}], ",", 
          RowBox[{"cc$10", "=", "0."}], ",", 
          RowBox[{"bb$10", "=", "0."}], ",", 
          RowBox[{"d1$10", "=", "0."}], ",", 
          RowBox[{"d$101", "=", "0."}], ",", 
          RowBox[{"C$10", "=", "0."}], ",", 
          RowBox[{"x123$10", "=", "1"}], ",", 
          RowBox[{"x1$10", "=", "0."}], ",", 
          RowBox[{"x2$10", "=", "0."}], ",", 
          RowBox[{"x3$10", "=", "0."}], ",", "v1$10", ",", "v2$10", ",", 
          "v3$10", ",", 
          RowBox[{"tol$10", "=", 
           RowBox[{"10.", "^", 
            RowBox[{"-", "24"}]}]}], ",", 
          RowBox[{"r$$0", "=", "0."}], ",", 
          RowBox[{"(*", 
           RowBox[{
           "tol$10", " ", "should", " ", "be", " ", "very", " ", "small"}], 
           "*)"}], "res", ",", "ires"}], "}"}], ",", 
        RowBox[{
         RowBox[{"fmat", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.", ",", 
            RowBox[{"{", "ndim", "}"}], ",", 
            RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fmat", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"fmat2", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], "ndim"}], "+", "1"}], ";;", 
               
               RowBox[{"i", " ", "ndim"}]}], "]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"emat", "=", 
          RowBox[{"0.5", 
           RowBox[{"(", 
            RowBox[{"fmat", "+", 
             RowBox[{"fmat", "\[Transpose]"}]}], ")"}]}]}], ";", 
         RowBox[{"res", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.", ",", 
            RowBox[{"{", 
             RowBox[{"2", "+", 
              RowBox[{"2", 
               RowBox[{"ndim", "^", "2"}]}]}], "}"}]}], "]"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"emat", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "i"}], "]"}], "]"}], "-=", "1."}], ";"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"elsum", "+=", 
            RowBox[{"emat", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "i"}], "]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"se", "=", 
          RowBox[{"shearG", " ", "emat"}]}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"+", 
            RowBox[{"(", 
             RowBox[{"bulkK", " ", "elsum"}], ")"}]}], 
           RowBox[{"IdentityMatrix", "[", "ndim", "]"}]}], "*)"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"se", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "i"}], "]"}], "]"}], "+=", 
            RowBox[{"elsum", " ", "bulkK"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"enerP", "+=", 
            RowBox[{
             RowBox[{"se", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", 
             RowBox[{"emat", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "ndim"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "ndim"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"enerP", "*=", "0.5"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"res", "[", 
             RowBox[{"[", 
              RowBox[{"2", "+", 
               RowBox[{"ndim", " ", 
                RowBox[{"(", 
                 RowBox[{"i", "-", "1"}], ")"}]}], "+", "j"}], "]"}], "]"}], 
            "=", 
            RowBox[{"se", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "ndim"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"enerP", "<", "gcl0"}], ",", 
           RowBox[{"Return", "[", "res", "]"}]}], "]"}], ";", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"In", " ", "the", " ", "compuation"}], ",", " ", 
           RowBox[{
           "gcl0", " ", "is", " ", "assumed", " ", "as", " ", "0.", " ", 
            "Therefore", " ", "this", " ", "code", " ", "will", " ", "never", 
            " ", 
            RowBox[{"run", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"sep", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.", ",", 
            RowBox[{"{", "ndim", "}"}], ",", 
            RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ndim", "\[Equal]", "2"}], ",", 
           RowBox[{"(*", 
            RowBox[{
            "eigenvalue", " ", "eigenvector", " ", "for", " ", "matrix", " ", 
             "2", "x2"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ematD", "=", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
               RowBox[{"4", " ", 
                RowBox[{
                 RowBox[{"emat", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], "-", 
               RowBox[{"2", " ", 
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "+", 
               RowBox[{
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
              "]"}]}], ";", 
            RowBox[{"el", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0.5", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", "ematD"}], 
                 ")"}]}], ",", 
               RowBox[{"0.5", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"emat", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", "ematD"}], 
                 ")"}]}]}], "}"}]}], ";", 
            RowBox[{"ev", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                   RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", "ematD", "+", 
                   
                   RowBox[{"10.", "^", 
                    RowBox[{"-", "30"}]}]}], ",", 
                  RowBox[{"2", " ", 
                   RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "}"}], "/", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{
                  RowBox[{"10.", "^", 
                   RowBox[{"-", "60"}]}], "+", 
                  RowBox[{"4", " ", 
                   RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], "+", 
                  
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", "ematD"}], 
                    ")"}], "^", "2"}]}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                   RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", "ematD"}], 
                  ",", 
                  RowBox[{
                   RowBox[{"2", " ", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "+", 
                   RowBox[{"10.", "^", 
                    RowBox[{"-", "30"}]}]}]}], "}"}], "/", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{
                  RowBox[{"10.", "^", 
                   RowBox[{"-", "60"}]}], "+", 
                  RowBox[{"4", " ", 
                   RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], "+", 
                  
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                    RowBox[{"emat", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", "ematD"}], 
                    ")"}], "^", "2"}]}], "]"}]}]}], "}"}]}], ";", 
            RowBox[{"elsum", "=", 
             RowBox[{
              RowBox[{"el", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", 
              RowBox[{"el", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], ";", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"elsum", ">", "0."}], ",", 
              RowBox[{"esp", "=", "elsum"}], ",", 
              RowBox[{"esn", "=", "elsum"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ">", "0."}], ",", 
              RowBox[{"e1p", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"e1n", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ">", "0."}], ",", 
              RowBox[{"e2p", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"e2n", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"n11", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}]}], 
                "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"n22", "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"1.", ",", "0."}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0.", ",", "1."}], "}"}]}], "}"}], "-", "n11"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"enerP", "=", 
             RowBox[{
              RowBox[{"0.5", "bulkK", " ", 
               RowBox[{"esp", "^", "2"}]}], "+", 
              RowBox[{"0.5", " ", "shearG", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"e1p", "^", "2"}], "+", 
                 RowBox[{"e2p", "^", "2"}]}], ")"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"enerN", "=", 
             RowBox[{
              RowBox[{"0.5", " ", "bulkK", " ", 
               RowBox[{"esn", "^", "2"}]}], "+", 
              RowBox[{"0.5", "shearG", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"e1n", "^", "2"}], "+", 
                 RowBox[{"e2n", "^", "2"}]}], ")"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"sep", "=", 
             RowBox[{
              RowBox[{"bulkK", " ", 
               RowBox[{"(", "  ", "esp", ")"}], 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"1.", ",", "0."}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0.", ",", "1."}], "}"}]}], "}"}]}], "+", 
              RowBox[{"shearG", 
               RowBox[{"(", " ", "e1p", ")"}], " ", "n11"}], "+", 
              RowBox[{"shearG", " ", 
               RowBox[{"(", "e2p", ")"}], "n22"}]}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ndim", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "eigenvalue", " ", "eigenvector", " ", "for", " ", "matrix", " ",
               "3", 
              RowBox[{"x3", ":", 
               RowBox[{"begin", "\[IndentingNewLine]", "a$10"}]}]}], ",", 
             "b$10", ",", "c$10", ",", "d$10", ",", "e$10", ",", "f$10", ",", 
             "dn$10", ",", "dd$10", ",", "cc$10", ",", "bb$10", ",", "d1$10", 
             ",", "d$101", ",", 
             RowBox[{"C$10", "=", 
              RowBox[{"0", "*", "I"}]}], ",", "x123$10", ",", "x1$10", ",", 
             "x2$10", ",", "x3$10", ",", "v1$10", ",", "v2$10", ",", "v3$10", 
             ",", 
             RowBox[{"tol$10", "=", 
              RowBox[{"10.", "^", 
               RowBox[{"-", "24"}]}]}]}], "\[IndentingNewLine]", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
              "a$10", ",", "b$10", ",", "c$10", ",", "d$10", ",", "e$10", ",",
                "f$10"}], "}"}], "=", 
             RowBox[{"Chop", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", 
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", 
                RowBox[{"emat", "[", 
                 RowBox[{"[", 
                  RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"dn$10", "=", 
             RowBox[{
              RowBox[{"b$10", " ", "b$10"}], "+", 
              RowBox[{"c$10", " ", "c$10"}], "+", 
              RowBox[{"e$10", " ", "e$10"}]}]}], ";", 
            RowBox[{"(*", "p1", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"v1$10", ",", "v2$10", ",", "v3$10"}], "}"}], "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"dn$10", "<", 
               RowBox[{"10.", "^", 
                RowBox[{"-", "16"}]}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"x1$10", ",", "x2$10", ",", "x3$10"}], "}"}], "=", 
                RowBox[{"{", 
                 RowBox[{"a$10", ",", "d$10", ",", "f$10"}], "}"}]}], ";", 
               RowBox[{"x123$10", "=", "1"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"dd$10", "=", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"a$10", "+", "d$10", "+", "f$10"}], ")"}], "/", 
                 "3."}]}], ";", 
               RowBox[{"(*", "q", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"cc$10", "=", 
                RowBox[{
                 RowBox[{"a$10", " ", "a$10"}], "+", 
                 RowBox[{"d$10", " ", "d$10"}], "+", 
                 RowBox[{"f$10", " ", "f$10"}], "-", 
                 RowBox[{"3", " ", "dd$10", " ", "dd$10"}], "+", 
                 RowBox[{"2", " ", "dn$10"}]}]}], ";", 
               RowBox[{"(*", "p2", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"bb$10", "=", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"cc$10", "/", "6"}], "]"}]}], ";", 
               RowBox[{"(*", "p", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"d1$10", "=", 
                RowBox[{
                 RowBox[{"a$10", " ", "d$10", " ", "f$10"}], "+", 
                 RowBox[{"2", " ", "b$10", " ", "e$10", " ", "c$10"}], "-", 
                 RowBox[{"a$10", " ", "e$10", " ", "e$10"}], "-", 
                 RowBox[{"d$10", " ", "c$10", " ", "c$10"}], "-", 
                 RowBox[{"f$10", " ", "b$10", " ", "b$10"}]}]}], ";", 
               RowBox[{"(*", "detA", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"d$101", "=", 
                RowBox[{"0.5", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"d1$10", "+", 
                    RowBox[{"dd$10", " ", "dn$10"}], "+", 
                    RowBox[{"2", " ", 
                    RowBox[{"dd$10", "^", "3"}]}], "-", 
                    RowBox[{"dd$10", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"a$10", " ", "d$10"}], "+", 
                    RowBox[{"a$10", " ", "f$10"}], "+", 
                    RowBox[{"d$10", " ", "f$10"}]}], ")"}]}]}], ")"}], "/", 
                  RowBox[{"bb$10", "^", "3"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Abs", "[", "d$101", "]"}], "\[GreaterEqual]", 
                  "1."}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"d$101", "\[LessEqual]", 
                    RowBox[{"-", "1."}]}], ",", 
                    RowBox[{
                    RowBox[{"x123$10", "=", "2"}], ";", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"x1$10", ",", "x3$10"}], "}"}], "=", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"dd$10", "+", "bb$10"}], ",", 
                    RowBox[{"dd$10", "-", 
                    RowBox[{"2", " ", "bb$10"}]}]}], "}"}]}], ";", 
                    RowBox[{"x2$10", "=", "x1$10"}]}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"d$101", "\[GreaterEqual]", "1."}], ",", 
                    RowBox[{
                    RowBox[{"x123$10", "=", "2"}], ";", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"x1$10", ",", "x3$10"}], "}"}], "=", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"dd$10", "-", "bb$10"}], ",", 
                    RowBox[{"dd$10", "+", 
                    RowBox[{"2", " ", "bb$10"}]}]}], "}"}]}], ";", 
                    RowBox[{"x2$10", "=", "x1$10"}]}]}], "]"}], ";"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"C$10", "=", 
                   RowBox[{
                    RowBox[{"ArcCos", "[", "d$101", "]"}], "/", "3."}]}], ";", 
                  RowBox[{"x123$10", "=", "3"}], ";", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"x1$10", ",", "x2$10"}], "}"}], "=", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"dd$10", "+", 
                    RowBox[{"2", " ", "bb$10", " ", 
                    RowBox[{"Cos", "[", "C$10", "]"}]}]}], ",", 
                    RowBox[{"dd$10", "+", 
                    RowBox[{"2", " ", "bb$10", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"C$10", "+", 
                    RowBox[{"2.", 
                    RowBox[{"\[Pi]", "/", "3"}]}]}], "]"}]}]}]}], "}"}]}], 
                  ";", 
                  RowBox[{"x3$10", "=", 
                   RowBox[{
                    RowBox[{"3", " ", "dd$10"}], "-", "x1$10", "-", 
                    "x2$10"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
               ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"x123$10", "\[Equal]", "2"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"v3$10", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"e$10", "^", "2"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"d$10", "-", "x3$10"}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"f$10", "-", "x3$10"}], ")"}]}]}], ",", 
                  RowBox[{
                   RowBox[{"c$10", " ", "e$10"}], "+", 
                   RowBox[{"b$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "f$10"}], "+", "x3$10"}], ")"}]}]}], ",", 
                  RowBox[{
                   RowBox[{"b$10", " ", "e$10"}], "+", 
                   RowBox[{"c$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "d$10"}], "+", "x3$10"}], ")"}]}]}]}], 
                 "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"r$$0", "=", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"v3$10", ".", "v3$10"}], "]"}]}], ";", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"r$$0", "<", 
                  RowBox[{"10.", "^", 
                   RowBox[{"-", "10"}]}]}], ",", 
                 RowBox[{"v3$10", "=", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], ",", 
                 RowBox[{"v3$10", "*=", 
                  RowBox[{"1.", "/", "r$$0"}]}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"v2$10", "=", 
                RowBox[{"v3$10", "+", 
                 RowBox[{"RandomReal", "[", 
                  RowBox[{"1.", ",", "3"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"v2$10", "-=", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v3$10", ".", "v2$10"}], ")"}], " ", "v3$10"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"v2$10", "*=", 
                RowBox[{"1.", "/", 
                 RowBox[{"Sqrt", "[", 
                  RowBox[{"v2$10", ".", "v2$10"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"v1$10", "=", 
                RowBox[{"Cross", "[", 
                 RowBox[{"v2$10", ",", "v3$10"}], "]"}]}], ";"}]}], "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"x123$10", "\[Equal]", "3"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"v1$10", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"e$10", "^", "2"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"d$10", "-", "x1$10"}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"f$10", "-", "x1$10"}], ")"}]}]}], ",", 
                  RowBox[{
                   RowBox[{"c$10", " ", "e$10"}], "+", 
                   RowBox[{"b$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "f$10"}], "+", "x1$10"}], ")"}]}]}], ",", 
                  RowBox[{
                   RowBox[{"b$10", " ", "e$10"}], "+", 
                   RowBox[{"c$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "d$10"}], "+", "x1$10"}], ")"}]}]}]}], 
                 "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"r$$0", "=", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"v1$10", ".", "v1$10"}], "]"}]}], ";", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"r$$0", "<", 
                  RowBox[{"10.", "^", 
                   RowBox[{"-", "10"}]}]}], ",", 
                 RowBox[{"v1$10", "=", 
                  RowBox[{"{", 
                   RowBox[{"1.", ",", "0.", ",", "0."}], "}"}]}], ",", 
                 RowBox[{"v1$10", "*=", 
                  RowBox[{"1.", "/", "r$$0"}]}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"v2$10", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"e$10", "^", "2"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"d$10", "-", "x2$10"}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"f$10", "-", "x2$10"}], ")"}]}]}], ",", 
                  RowBox[{
                   RowBox[{"c$10", " ", "e$10"}], "+", 
                   RowBox[{"b$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "f$10"}], "+", "x2$10"}], ")"}]}]}], ",", 
                  RowBox[{
                   RowBox[{"b$10", " ", "e$10"}], "+", 
                   RowBox[{"c$10", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "d$10"}], "+", "x2$10"}], ")"}]}]}]}], 
                 "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"r$$0", "=", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"v2$10", ".", "v2$10"}], "]"}]}], ";", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"r$$0", "<", 
                  RowBox[{"10.", "^", 
                   RowBox[{"-", "10"}]}]}], ",", 
                 RowBox[{"v2$10", "=", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", "1.", ",", "0."}], "}"}]}], ",", 
                 RowBox[{"v2$10", "*=", 
                  RowBox[{"1.", "/", "r$$0"}]}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"v2$10", "*=", 
                RowBox[{"1.", "/", 
                 RowBox[{"Sqrt", "[", 
                  RowBox[{"v2$10", ".", "v2$10"}], "]"}]}]}], ";", 
               RowBox[{"v3$10", "=", 
                RowBox[{"Cross", "[", 
                 RowBox[{"v1$10", ",", "v2$10"}], "]"}]}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"el", "=", 
             RowBox[{"{", 
              RowBox[{"x1$10", ",", "x2$10", ",", "x3$10"}], "}"}]}], ";", 
            RowBox[{"ev", "=", 
             RowBox[{"{", 
              RowBox[{"v1$10", ",", "v2$10", ",", "v3$10"}], "}"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"eigenvalue", " ", "eigenvector", " ", "for", " ", 
              RowBox[{"m33", ":", "end"}]}], "*)"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"elsum", "=", 
             RowBox[{
              RowBox[{"el", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", 
              RowBox[{"el", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "+", 
              RowBox[{"el", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"elsum", ">", "0."}], ",", 
              RowBox[{"esp", "=", "elsum"}], ",", 
              RowBox[{"esn", "=", "elsum"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ">", "0."}], ",", 
              RowBox[{"e1p", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"e1n", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ">", "0."}], ",", 
              RowBox[{"e2p", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"e2n", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"el", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ">", "0."}], ",", 
              RowBox[{"e3p", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"e3n", "=", 
               RowBox[{"el", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"enerP", "=", 
             RowBox[{
              RowBox[{"0.5", "bulkK", " ", 
               RowBox[{"esp", "^", "2"}]}], "+", 
              RowBox[{"0.5", "shearG", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"e1p", "^", "2"}], "+", 
                 RowBox[{"e2p", "^", "2"}], "+", 
                 RowBox[{"e3p", "^", "2"}]}], ")"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"enerN", "=", 
             RowBox[{
              RowBox[{"0.5", " ", "bulkK", " ", 
               RowBox[{"esn", "^", "2"}]}], "+", 
              RowBox[{"0.5", "shearG", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"e1n", "^", "2"}], "+", 
                 RowBox[{"e2n", "^", "2"}], "+", 
                 RowBox[{"e3n", "^", "2"}]}], ")"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"n11", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "^", "2"}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "^", "2"}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                "}"}]}], "\[IndentingNewLine]", "}"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"n22", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "^", "2"}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], " ", 
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"ev", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                "}"}]}], "\[IndentingNewLine]", "}"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"n33", "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}], "-", 
              "n11", "-", "n22"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"sep", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"bulkK", " ", "esp"}], ")"}], 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}]}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"shearG", " ", "e1p"}], ")"}], " ", "n11"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"shearG", "  ", "e2p"}], ")"}], "n22"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"shearG", " ", "e3p"}], ")"}], "n33"}]}]}], ";"}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"ires", "=", 
          RowBox[{"2", "+", 
           RowBox[{"ndim", " ", "ndim"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "enerP"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "=", "enerN"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"res", "[", 
             RowBox[{"[", 
              RowBox[{"ires", "+", 
               RowBox[{"ndim", 
                RowBox[{"(", 
                 RowBox[{"i", "-", "1"}], ")"}]}], "+", "j"}], "]"}], "]"}], 
            "=", 
            RowBox[{"sep", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "ndim"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "res"}]}], "]"}], ",", 
      RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}], ",", 
      RowBox[{"RuntimeOptions", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], "}"}]}],
       ",", 
      RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.7802890238113832`*^9, 3.780289025733015*^9}, {
   3.780289305700425*^9, 3.7802896671549673`*^9}, {3.7802897738976393`*^9, 
   3.780290113343313*^9}, {3.7802901487330313`*^9, 3.780290278040339*^9}, {
   3.780290387182002*^9, 3.780290427511304*^9}, {3.780290474715179*^9, 
   3.780290649515025*^9}, {3.780290730586748*^9, 3.780290804708366*^9}, {
   3.7802908432141113`*^9, 3.780290883697959*^9}, {3.78029093467837*^9, 
   3.780291045301403*^9}, 3.780291080164556*^9, {3.780291137802397*^9, 
   3.780291171501103*^9}, 3.7802915900939293`*^9, {3.780295445053925*^9, 
   3.780295450883807*^9}, 3.780295819791102*^9, {3.7802989955013866`*^9, 
   3.780299057393745*^9}, {3.780299094957065*^9, 3.780299099265417*^9}, {
   3.780486269064595*^9, 3.7804862698283367`*^9}, {3.837400331866725*^9, 
   3.837400355639187*^9}, {3.837400391383851*^9, 3.8374004428878*^9}, {
   3.837400499680393*^9, 3.837400508391068*^9}, {3.8374834808408437`*^9, 
   3.8374835958068533`*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"6a26dbca-3eaa-44f4-b364-e60f0984ca9d"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"eigenvalue", " ", "eigenvector", " ", "for", " ", 
     RowBox[{"m33", ":", 
      RowBox[{"begin", "\[IndentingNewLine]", "a$10"}]}]}], ",", "b$10", ",", 
    "c$10", ",", "d$10", ",", "e$10", ",", "f$10", ",", "dn$10", ",", "dd$10",
     ",", "cc$10", ",", "bb$10", ",", "d1$10", ",", "d$101", ",", 
    RowBox[{"C$10", "=", 
     RowBox[{"0", "*", "I"}]}], ",", "x123$10", ",", "x1$10", ",", "x2$10", 
    ",", "x3$10", ",", "v1$10", ",", "v2$10", ",", "v3$10", ",", 
    RowBox[{"tol$10", "=", 
     RowBox[{"10.", "^", 
      RowBox[{"-", "24"}]}]}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Eigem3", "[", "emat_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "a$10", ",", "b$10", ",", "c$10", ",", "d$10", ",", "e$10", ",", "f$10",
        ",", "dn$10", ",", "dd$10", ",", "cc$10", ",", "bb$10", ",", "d1$10", 
       ",", "d$101", ",", "C$10", ",", "x123$10", ",", "x1$10", ",", "x2$10", 
       ",", "x3$10", ",", "v1$10", ",", "v2$10", ",", "v3$10", ",", 
       RowBox[{"tol$10", "=", 
        RowBox[{"10.", "^", 
         RowBox[{"-", "24"}]}]}], ",", "el", ",", "ev", ",", "r0"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "a$10", ",", "b$10", ",", "c$10", ",", "d$10", ",", "e$10", ",", 
         "f$10"}], "}"}], "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"emat", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"emat", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"emat", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", 
          RowBox[{"emat", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"emat", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "3"}], "]"}], "]"}], ",", 
          RowBox[{"emat", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "3"}], "]"}], "]"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dn$10", "=", 
       RowBox[{
        RowBox[{"b$10", " ", "b$10"}], "+", 
        RowBox[{"c$10", " ", "c$10"}], "+", 
        RowBox[{"e$10", " ", "e$10"}]}]}], ";", 
      RowBox[{"(*", "p1", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v1$10", ",", "v2$10", ",", "v3$10"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1.", ",", "0.", ",", "0."}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.", ",", "1.", ",", "0."}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"dn$10", "<", 
         RowBox[{"10.", "^", 
          RowBox[{"-", "20"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x1$10", ",", "x2$10", ",", "x3$10"}], "}"}], "=", 
          RowBox[{"{", 
           RowBox[{"a$10", ",", "d$10", ",", "f$10"}], "}"}]}], ";", 
         RowBox[{"x123$10", "=", "1"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dd$10", "=", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"a$10", "+", "d$10", "+", "f$10"}], ")"}], "/", "3."}]}], 
         ";", 
         RowBox[{"(*", "q", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"cc$10", "=", 
          RowBox[{
           RowBox[{"a$10", " ", "a$10"}], "+", 
           RowBox[{"d$10", " ", "d$10"}], "+", 
           RowBox[{"f$10", " ", "f$10"}], "-", 
           RowBox[{"3", " ", "dd$10", " ", "dd$10"}], "+", 
           RowBox[{"2", " ", "dn$10"}]}]}], ";", 
         RowBox[{"(*", "p2", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"bb$10", "=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"cc$10", "/", "6"}], "]"}]}], ";", 
         RowBox[{"(*", "p", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"d1$10", "=", 
          RowBox[{
           RowBox[{"a$10", " ", "d$10", " ", "f$10"}], "+", 
           RowBox[{"2", " ", "b$10", " ", "e$10", " ", "c$10"}], "-", 
           RowBox[{"a$10", " ", "e$10", " ", "e$10"}], "-", 
           RowBox[{"d$10", " ", "c$10", " ", "c$10"}], "-", 
           RowBox[{"f$10", " ", "b$10", " ", "b$10"}]}]}], ";", 
         RowBox[{"(*", "detA", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"d$101", "=", 
          RowBox[{"0.5", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"d1$10", "+", 
              RowBox[{"dd$10", " ", "dn$10"}], "+", 
              RowBox[{"2", " ", 
               RowBox[{"dd$10", "^", "3"}]}], "-", 
              RowBox[{"dd$10", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"a$10", " ", "d$10"}], "+", 
                 RowBox[{"a$10", " ", "f$10"}], "+", 
                 RowBox[{"d$10", " ", "f$10"}]}], ")"}]}]}], ")"}], "/", 
            RowBox[{"bb$10", "^", "3"}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", "d$101", "]"}], "\[GreaterEqual]", "1."}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"d$101", "\[LessEqual]", 
               RowBox[{"-", "1."}]}], ",", 
              RowBox[{
               RowBox[{"x123$10", "=", "2"}], ";", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"x1$10", ",", "x3$10"}], "}"}], "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"dd$10", "+", "bb$10"}], ",", 
                  RowBox[{"dd$10", "-", 
                   RowBox[{"2", " ", "bb$10"}]}]}], "}"}]}], ";", 
               RowBox[{"x2$10", "=", "x1$10"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"d$101", "\[GreaterEqual]", "1."}], ",", 
              RowBox[{
               RowBox[{"x123$10", "=", "2"}], ";", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"x1$10", ",", "x3$10"}], "}"}], "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"dd$10", "-", "bb$10"}], ",", 
                  RowBox[{"dd$10", "+", 
                   RowBox[{"2", " ", "bb$10"}]}]}], "}"}]}], ";", 
               RowBox[{"x2$10", "=", "x1$10"}]}]}], "]"}], ";"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"C$10", "=", 
             RowBox[{
              RowBox[{"ArcCos", "[", "d$101", "]"}], "/", "3."}]}], ";", 
            RowBox[{"x123$10", "=", "3"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"x1$10", ",", "x2$10"}], "}"}], "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"dd$10", "+", 
                RowBox[{"2", " ", "bb$10", " ", 
                 RowBox[{"Cos", "[", "C$10", "]"}]}]}], ",", 
               RowBox[{"dd$10", "+", 
                RowBox[{"2", " ", "bb$10", " ", 
                 RowBox[{"Cos", "[", 
                  RowBox[{"C$10", "+", 
                   RowBox[{"2.", 
                    RowBox[{"\[Pi]", "/", "3"}]}]}], "]"}]}]}]}], "}"}]}], 
            ";", 
            RowBox[{"x3$10", "=", 
             RowBox[{
              RowBox[{"3", " ", "dd$10"}], "-", "x1$10", "-", "x2$10"}]}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"x123$10", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"v3$10", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              RowBox[{"e$10", "^", "2"}]}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"d$10", "-", "x3$10"}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{"f$10", "-", "x3$10"}], ")"}]}]}], ",", 
            RowBox[{
             RowBox[{"c$10", " ", "e$10"}], "+", 
             RowBox[{"b$10", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "f$10"}], "+", "x3$10"}], ")"}]}]}], ",", 
            RowBox[{
             RowBox[{"b$10", " ", "e$10"}], "+", 
             RowBox[{"c$10", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "d$10"}], "+", "x3$10"}], ")"}]}]}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"r0", "=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"v3$10", ".", "v3$10"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"r0", "<", 
            RowBox[{"10.", "^", 
             RowBox[{"-", "10"}]}]}], ",", 
           RowBox[{"v3$10", "=", 
            RowBox[{"{", 
             RowBox[{"0.", ",", "0.", ",", "1."}], "}"}]}], ",", 
           RowBox[{"v3$10", "*=", 
            RowBox[{"1.", "/", "r0"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"v2$10", "=", 
          RowBox[{"v3$10", "+", 
           RowBox[{"RandomReal", "[", 
            RowBox[{"1.", ",", "3"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"v2$10", "-=", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"v3$10", ".", "v2$10"}], ")"}], " ", "v3$10"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"v2$10", "*=", 
          RowBox[{"1.", "/", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"v2$10", ".", "v2$10"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"v1$10", "=", 
          RowBox[{"Cross", "[", 
           RowBox[{"v2$10", ",", "v3$10"}], "]"}]}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"x123$10", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"v1$10", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              RowBox[{"e$10", "^", "2"}]}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"d$10", "-", "x1$10"}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{"f$10", "-", "x1$10"}], ")"}]}]}], ",", 
            RowBox[{
             RowBox[{"c$10", " ", "e$10"}], "+", 
             RowBox[{"b$10", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "f$10"}], "+", "x1$10"}], ")"}]}]}], ",", 
            RowBox[{
             RowBox[{"b$10", " ", "e$10"}], "+", 
             RowBox[{"c$10", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "d$10"}], "+", "x1$10"}], ")"}]}]}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"r0", "=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"v1$10", ".", "v1$10"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"r0", "<", 
            RowBox[{"10.", "^", 
             RowBox[{"-", "10"}]}]}], ",", 
           RowBox[{"v1$10", "=", 
            RowBox[{"{", 
             RowBox[{"1.", ",", "0.", ",", "0."}], "}"}]}], ",", 
           RowBox[{"v1$10", "*=", 
            RowBox[{"1.", "/", "r0"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"v2$10", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              RowBox[{"e$10", "^", "2"}]}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"d$10", "-", "x2$10"}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{"f$10", "-", "x2$10"}], ")"}]}]}], ",", 
            RowBox[{
             RowBox[{"c$10", " ", "e$10"}], "+", 
             RowBox[{"b$10", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "f$10"}], "+", "x2$10"}], ")"}]}]}], ",", 
            RowBox[{
             RowBox[{"b$10", " ", "e$10"}], "+", 
             RowBox[{"c$10", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "d$10"}], "+", "x2$10"}], ")"}]}]}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"r0", "=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"v2$10", ".", "v2$10"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"r0", "<", 
            RowBox[{"10.", "^", 
             RowBox[{"-", "10"}]}]}], ",", 
           RowBox[{"v2$10", "=", 
            RowBox[{"{", 
             RowBox[{"0.", ",", "1.", ",", "0."}], "}"}]}], ",", 
           RowBox[{"v2$10", "*=", 
            RowBox[{"1.", "/", "r0"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"v2$10", "*=", 
          RowBox[{"1.", "/", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"v2$10", ".", "v2$10"}], "]"}]}]}], ";", 
         RowBox[{"v3$10", "=", 
          RowBox[{"Cross", "[", 
           RowBox[{"v1$10", ",", "v2$10"}], "]"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"el", "=", 
       RowBox[{"{", 
        RowBox[{"x1$10", ",", "x2$10", ",", "x3$10"}], "}"}]}], ";", 
      RowBox[{"ev", "=", 
       RowBox[{"{", 
        RowBox[{"v1$10", ",", "v2$10", ",", "v3$10"}], "}"}]}], ";", 
      RowBox[{"{", 
       RowBox[{"el", ",", "ev"}], "}"}]}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"eigenvalue", " ", "eigenvector", " ", "for", " ", 
    RowBox[{"m33", ":", "end"}]}], "*)"}], "*)"}]], "Input",
 CellChangeTimes->{{3.780294694837627*^9, 3.780294768126865*^9}, {
   3.780295357715547*^9, 3.780295364634293*^9}, {3.780298749600993*^9, 
   3.780298949371676*^9}, 3.837483692130486*^9},
 CellLabel->"In[95]:=",ExpressionUUID->"f13e3270-d0a1-4910-ab11-7f6654e9c68d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ForceAccumulateHgC", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"uvwi", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"coordi", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"stressv", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Fmatv", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"invK", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"trK", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"voli", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"hgPen", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"WeiL", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fi", ",", "fl", ",", 
         RowBox[{"num", "=", 
          RowBox[{"Length", "[", "coordi", "]"}]}], ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"coordi", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "xi", ",", "ri", 
         ",", "vi", ",", "vw", ",", "stress", ",", "Fmat"}], "}"}], ",", 
       RowBox[{
        RowBox[{"fl", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "num", "}"}], ",", 
           RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"stress", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "ndim", "}"}], ",", 
           RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Fmat", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "ndim", "}"}], ",", 
           RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"stress", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"stressv", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], "ndim"}], "+", "1"}], ";;", 
               
               RowBox[{"i", " ", "ndim"}]}], "]"}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"Fmat", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"Fmatv", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], "ndim"}], "+", "1"}], ";;", 
               
               RowBox[{"i", " ", "ndim"}]}], "]"}], "]"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"xi", "=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"coordi", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "-", 
              RowBox[{"coordi", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"vi", "=", 
            RowBox[{
             RowBox[{"Fmat", ".", "xi"}], "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"uvwi", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"uvwi", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"vw", "=", 
            RowBox[{
             RowBox[{"voli", "[", 
              RowBox[{"[", "1", "]"}], "]"}], 
             RowBox[{"voli", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "  ", 
             RowBox[{"WeiL", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"fi", "=", 
            RowBox[{"vw", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"stress", ".", 
                RowBox[{"(", 
                 RowBox[{"invK", ".", "xi"}], ")"}]}], "-", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"hgPen", " ", "/", "trK"}], ")"}], "vi"}]}], 
              ")"}]}]}], ";", 
           RowBox[{
            RowBox[{"fl", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+=", "fi"}], ";", 
           RowBox[{
            RowBox[{"fl", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "=", 
            RowBox[{"-", "fi"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "2", ",", "num"}], "}"}]}], "]"}], ";", "fl"}]}],
       "]"}], ",", 
     RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"RuntimeOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], "}"}]}], 
     ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ForceListAll", "[", 
    RowBox[{
    "neiList_", ",", "neicoord_", ",", "neicoord0_", ",", "stress_", ",", 
     "fmat_", ",", "invKList_", ",", "trKList_", ",", "neivol_", ",", 
     "hgPen_", ",", "neiWeiL_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "forceL", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"invKList", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"num", "=", 
        RowBox[{"Length", "[", "trKList", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"forceL", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"num", ",", "ndim"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"res", "=", 
       RowBox[{"ForceAccumulateHgC", "[", 
        RowBox[{
        "neicoord", ",", "neicoord0", ",", "stress", ",", "fmat", ",", 
         "invKList", ",", "trKList", ",", "neivol", ",", "hgPen", ",", 
         "neiWeiL"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"forceL", "[", 
           RowBox[{"[", 
            RowBox[{"neiList", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "+=", 
          RowBox[{"res", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", "forceL"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ForceAccumulateHgCpf", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"uvwi", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"coordi", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"stressv", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Fmatv", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"invK", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"trK", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"voli", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"hgPen", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"WeiL", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"pfL", ",", "_Real"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fi", ",", "fl", ",", 
         RowBox[{"num", "=", 
          RowBox[{"Length", "[", "coordi", "]"}]}], ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"coordi", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "xi", ",", "ri", 
         ",", "vi", ",", "vw", ",", "stress", ",", "Fmat", ",", 
         RowBox[{"pfw", "=", 
          RowBox[{"Abs", "[", 
           RowBox[{"(", 
            RowBox[{"1.", "-", "pfL"}], ")"}], "]"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"fl", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "num", "}"}], ",", 
           RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"stress", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "ndim", "}"}], ",", 
           RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Fmat", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "ndim", "}"}], ",", 
           RowBox[{"{", "ndim", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"stress", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"stressv", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], "ndim"}], "+", "1"}], ";;", 
               
               RowBox[{"i", " ", "ndim"}]}], "]"}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"Fmat", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{"Fmatv", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], "ndim"}], "+", "1"}], ";;", 
               
               RowBox[{"i", " ", "ndim"}]}], "]"}], "]"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "ndim"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"xi", "=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"coordi", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "-", 
              RowBox[{"coordi", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"vi", "=", 
            RowBox[{
             RowBox[{"Fmat", ".", "xi"}], "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"uvwi", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"uvwi", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"vw", "=", 
            RowBox[{
             RowBox[{"voli", "[", 
              RowBox[{"[", "1", "]"}], "]"}], 
             RowBox[{"voli", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "  ", 
             RowBox[{"WeiL", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"fi", "=", 
            RowBox[{"vw", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"stress", ".", 
                RowBox[{"(", 
                 RowBox[{"invK", ".", "xi"}], ")"}]}], "-", 
               RowBox[{"pfw", 
                RowBox[{"(", 
                 RowBox[{"hgPen", " ", "/", "trK"}], ")"}], "vi"}]}], 
              ")"}]}]}], ";", 
           RowBox[{
            RowBox[{"fl", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+=", "fi"}], ";", 
           RowBox[{
            RowBox[{"fl", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "=", 
            RowBox[{"-", "fi"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "2", ",", "num"}], "}"}]}], "]"}], ";", "fl"}]}],
       "]"}], ",", 
     RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
     RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"RuntimeOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], "}"}]}], 
     ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ForceListAllpf", "[", 
    RowBox[{
    "neiList_", ",", "neicoord_", ",", "neicoord0_", ",", "stress_", ",", 
     "fmat_", ",", "invKList_", ",", "trKList_", ",", "neivol_", ",", 
     "hgPen_", ",", "neiWeiL_", ",", "pfList_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "forceL", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"invKList", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"num", "=", 
        RowBox[{"Length", "[", "trKList", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"forceL", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"num", ",", "ndim"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"res", "=", 
       RowBox[{"ForceAccumulateHgCpf", "[", 
        RowBox[{
        "neicoord", ",", "neicoord0", ",", "stress", ",", "fmat", ",", 
         "invKList", ",", "trKList", ",", "neivol", ",", "hgPen", ",", 
         "neiWeiL", ",", "pfList"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"forceL", "[", 
           RowBox[{"[", 
            RowBox[{"neiList", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "+=", 
          RowBox[{"res", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", "forceL"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7783908502502623`*^9, 3.7783908971549454`*^9}, {
   3.778390930950878*^9, 3.7783910333887377`*^9}, {3.7783910986304693`*^9, 
   3.778391119769678*^9}, {3.7783968252650137`*^9, 3.778397159166112*^9}, {
   3.7783981357519693`*^9, 3.7783981370040407`*^9}, {3.778411239104356*^9, 
   3.778411242003522*^9}, {3.7785622479151587`*^9, 3.7785624647475605`*^9}, {
   3.7785774481855426`*^9, 3.778577448384554*^9}, {3.779114103767004*^9, 
   3.779114111815*^9}, 3.7804501205399313`*^9, {3.7804862789722853`*^9, 
   3.78048628691529*^9}, {3.780486650863778*^9, 3.7804866519949923`*^9}},
 CellLabel->"In[96]:=",ExpressionUUID->"127bbe67-8325-4891-9cd8-d33b209d1c47"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PhaseFieldAccumulateHgC", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coordi", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"gradS", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"si", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"invK", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"trK", ",", "_Real"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"voli", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"WeiL", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"hgPen", ",", "_Real"}], "}"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fi", ",", "fl", ",", 
         RowBox[{"num", "=", 
          RowBox[{"Length", "[", "coordi", "]"}]}], ",", 
         RowBox[{"ndim", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"coordi", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "xi", ",", "ri", 
         ",", "vi", ",", "vw"}], "}"}], ",", 
       RowBox[{
        RowBox[{"fl", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", "num", "}"}]}], "]"}]}], ";", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"xi", "=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"coordi", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "-", 
              RowBox[{"coordi", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"vi", "=", 
            RowBox[{
             RowBox[{"gradS", ".", "xi"}], "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"si", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "-", 
               RowBox[{"si", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"vw", "=", 
            RowBox[{
             RowBox[{"voli", "[", 
              RowBox[{"[", "1", "]"}], "]"}], 
             RowBox[{"voli", "[", 
              RowBox[{"[", "j", "]"}], "]"}], " ", 
             RowBox[{"WeiL", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"fi", "=", 
            RowBox[{"vw", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"gradS", ".", 
                RowBox[{"(", 
                 RowBox[{"invK", ".", "xi"}], ")"}]}], "-", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"hgPen", " ", "/", "trK"}], ")"}], "vi"}]}], 
              ")"}]}]}], ";", 
           RowBox[{
            RowBox[{"fl", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+=", "fi"}], ";", 
           RowBox[{
            RowBox[{"fl", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "=", 
            RowBox[{"-", "fi"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "2", ",", "num"}], "}"}]}], "]"}], ";", "fl"}]}],
       "]"}], ",", 
     RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"RuntimeOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<EvaluateSymbolically\>\"", "\[Rule]", "False"}], "}"}]}], 
     ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LaplaceSListAll", "[", 
    RowBox[{
    "neiList_", ",", "neicoord0_", ",", "gradS_", ",", "neipfList_", ",", 
     "invKList_", ",", "trKList_", ",", "neivol_", ",", "hgPen_", ",", 
     "neiWeiL_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "lapS", ",", 
       RowBox[{"ndim", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"trKList", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"num", "=", 
        RowBox[{"Length", "[", "trKList", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"lapS", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", "num"}], "]"}]}], ";", 
      RowBox[{"res", "=", 
       RowBox[{"PhaseFieldAccumulateHgC", "[", 
        RowBox[{
        "neicoord0", ",", "gradS", ",", "neipfList", ",", "invKList", ",", 
         "trKList", ",", "neivol", ",", "neiWeiL", ",", "hgPen"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"lapS", "[", 
           RowBox[{"[", 
            RowBox[{"neiList", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "+=", 
          RowBox[{"res", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", "lapS"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.778391564386109*^9, 3.778391585900339*^9}, {
   3.7783944332832003`*^9, 3.778394436810402*^9}, 3.7783967917930994`*^9, {
   3.778397190463902*^9, 3.778397307668606*^9}, {3.778397341968568*^9, 
   3.7783973799547405`*^9}, 3.780229831081666*^9, {3.780486292343644*^9, 
   3.780486292934042*^9}},
 CellLabel->
  "In[100]:=",ExpressionUUID->"f7712f3b-5a7c-4da8-b7fb-02fa52209e7b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"PhaseFieldResidual", "[", 
      RowBox[{
      "ls_", ",", "gc_", ",", "lapS_List", ",", "pf_List", ",", 
       "enerP_List"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"num", "=", 
          RowBox[{"Length", "[", "pf", "]"}]}], ",", "res"}], "}"}], ",", 
       RowBox[{
        RowBox[{"res", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"ls", "^", "2"}], " ", "lapS"}], "-", "pf", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"2", " ", 
             RowBox[{"ls", "/", "gc"}]}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1.", "-", "pf"}], ")"}], " ", "enerP"}]}]}], ";", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "<", "0."}], ",", 
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", "0."}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", "res"}]}], "]"}]}],
     ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"PhaseFieldResidual2", "[", 
      RowBox[{
      "ls_", ",", "gc_", ",", "lapS_List", ",", "pf_List", ",", 
       "enerP_List"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"num", "=", 
          RowBox[{"Length", "[", "pf", "]"}]}], ",", "res"}], "}"}], ",", 
       RowBox[{
        RowBox[{"res", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"ls", "^", "2"}], " ", "lapS"}], "-", "pf", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"2", " ", 
             RowBox[{"ls", "/", "gc"}]}], ")"}], 
           RowBox[{"(", 
            RowBox[{"1.", "-", "pf"}], ")"}], " ", "enerP"}]}]}], ";", 
        "res"}]}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"PhaseFieldResidual", "[", 
      RowBox[{
      "ls_", ",", "gc_", ",", "lapS_List", ",", "pf_List", ",", 
       "enerP_List"}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"num", "=", 
          RowBox[{"Length", "[", "pf", "]"}]}], ",", "HD", ",", "res"}], 
        "}"}], ",", 
       RowBox[{
        RowBox[{"HD", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"6.", "/", "gc"}], ")"}], " ", "enerP", " ", "ls"}], "-", 
          "1."}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"HD", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "<", "0."}], ",", 
            RowBox[{
             RowBox[{"HD", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", "0."}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"res", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"ls", "^", "2"}], " ", "lapS"}], "-", "pf", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1.", "-", "pf"}], ")"}], " ", "HD"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "<", "0."}], ",", 
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "=", "0."}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", "res"}]}], "]"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"PhaseFieldResidualMC", "[", 
       RowBox[{
       "ls_", ",", "gc_", ",", "lapS_List", ",", "pf_List", ",", 
        "enerP_List"}], "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"num", "=", 
           RowBox[{"Length", "[", "pf", "]"}]}], ",", "HD", ",", "res", ",", 
          "HDmax"}], "}"}], ",", 
        RowBox[{
         RowBox[{"HD", "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"6.", "/", "gc"}], ")"}], " ", 
              RowBox[{"enerP", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "ls"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"6.", "/", "gc"}], ")"}], " ", 
               RowBox[{"enerP", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "ls"}], "-", 
              "1."}]}], "}"}], "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"HD", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "<", "0."}], ",", 
               RowBox[{
                RowBox[{"HD", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "=", "0."}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"HDmax", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"0.", ",", 
              RowBox[{"Max", "[", 
               RowBox[{"HD", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "num"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"HDmax", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"0.", ",", 
              RowBox[{"HD", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "num"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"res", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"ls", "^", "2"}], " ", "lapS"}], "-", "pf", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1.", "-", "pf"}], ")"}], " ", "HDmax"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"res", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "<", "0."}], ",", 
             RowBox[{
              RowBox[{"res", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "=", "0."}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", "res"}]}], 
       "]"}]}], ";"}], "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.778828357437501*^9, 3.7788283700974503`*^9}, {
   3.779643246821316*^9, 3.779643251695867*^9}, {3.782051262573704*^9, 
   3.7820512666229353`*^9}, {3.7820518289460983`*^9, 
   3.7820518324032965`*^9}, {3.7820519232874947`*^9, 
   3.7820519534282184`*^9}, {3.7820520001628914`*^9, 3.782052094084264*^9}, 
   3.782052299926037*^9, {3.782129647970417*^9, 3.7821296725538235`*^9}, {
   3.8373974599454937`*^9, 3.8373974680972013`*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"2358f125-8d86-43bf-a779-8f3dc25979eb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"PlaneStress", " ", "return", " ", 
     RowBox[{"{", 
      RowBox[{"E", ",", "v"}], "}"}]}], "\[Rule]", " ", 
    RowBox[{"{", 
     RowBox[{"\[Lambda]", ",", 
      RowBox[{"2", "G"}]}], "}"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"PlaneStress", "[", 
     RowBox[{"Es_", ",", "mu_", ",", 
      RowBox[{"flag_:", "True"}]}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{"flag", ",", 
      RowBox[{
       RowBox[{"Es", "/", 
        RowBox[{"(", 
         RowBox[{"1.", "-", 
          RowBox[{"mu", "^", "2"}]}], ")"}]}], 
       RowBox[{"{", 
        RowBox[{"mu", ",", 
         RowBox[{"1.", "-", "mu"}]}], "}"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Es", "/", 
         RowBox[{"(", 
          RowBox[{"1.", "+", "mu"}], ")"}]}], "/", 
        RowBox[{"(", 
         RowBox[{"1.", "-", 
          RowBox[{"2", " ", "mu"}]}], ")"}]}], 
       RowBox[{"{", 
        RowBox[{"mu", ",", 
         RowBox[{"1.", "-", 
          RowBox[{"2", " ", "mu"}]}]}], "}"}]}]}], "]"}]}], ";"}]}]], "Input",\

 CellLabel->
  "In[103]:=",ExpressionUUID->"33b9b803-735b-49e4-9ad7-27212ead0651"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"StrainEnergyCal", "[", 
    RowBox[{"stress_", ",", "deform_", ",", "vol_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", "0."}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"res", "+=", 
         RowBox[{"0.5", " ", 
          RowBox[{"vol", "[", 
           RowBox[{"[", "i", "]"}], "]"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"stress", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ".", 
            RowBox[{"deform", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "vol", "]"}]}], "}"}]}], "]"}], ";", 
      "res"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"StrainEnergyCal", "[", 
    RowBox[{"enerP_", ",", "enerN_", ",", "vol_", ",", "pfList_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", "0."}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"res", "+=", " ", 
         RowBox[{
          RowBox[{"vol", "[", 
           RowBox[{"[", "i", "]"}], "]"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"enerP", "[", 
              RowBox[{"[", "i", "]"}], "]"}], 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1.", "-", 
                RowBox[{"pfList", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ")"}], "^", "2"}]}], "+", 
            RowBox[{"enerN", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "vol", "]"}]}], "}"}]}], "]"}], ";", 
      "res"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PhaseFieldEnergy", "[", 
    RowBox[{"pfList_", ",", "gradS_", ",", "ls_", ",", "vol_"}], "]"}], ":=", 
   
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"num", "=", 
        RowBox[{"Length", "[", "pfList", "]"}]}], ",", 
       RowBox[{"res", "=", "0."}], ",", "lsl", ",", "li"}], "}"}], ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"{", "List", "}"}], ",", 
          RowBox[{"Head", "[", "ls", "]"}]}], "]"}], ",", 
        RowBox[{"lsl", "=", "ls"}], ",", 
        RowBox[{"lsl", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"ls", ",", "num"}], "]"}]}]}], "]"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"li", "=", 
          RowBox[{"lsl", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"res", "+=", 
          RowBox[{"0.5", " ", 
           RowBox[{"vol", "[", 
            RowBox[{"[", "i", "]"}], "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"pfList", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "^", "2"}], "/", "li"}], "+", 
             
             RowBox[{"li", " ", 
              RowBox[{
               RowBox[{"gradS", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ".", 
               RowBox[{"gradS", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}]}]}], ")"}]}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", "res"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.77901666042057*^9, 3.7790166668359537`*^9}},
 CellLabel->
  "In[104]:=",ExpressionUUID->"312f426b-2b9c-40f9-9100-f8b87f1b4699"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Join", " ", "the", " ", "matrix", " ", "and", " ", "a", " ", "vector", 
    " ", "horizontally"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"JoinH", "[", 
     RowBox[{"mat_", ",", "vec_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"nv", ",", 
        RowBox[{"mc", "=", "1"}], ",", "nm", ",", 
        RowBox[{"vc", "=", "1"}], ",", "res"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "mat", "]"}], "\[NotEqual]", 
          RowBox[{"Length", "[", "vec", "]"}]}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<Error, variables with different lengths, cannot be joined \
horizontally.\>\"", "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"nm", "=", 
        RowBox[{"Dimensions", "[", "mat", "]"}]}], ";", 
       RowBox[{"nv", "=", 
        RowBox[{"Dimensions", "[", "vec", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "nv", "]"}], "\[NotEqual]", "1"}], ",", 
         RowBox[{"vc", "=", 
          RowBox[{"nv", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "nm", "]"}], "\[NotEqual]", "1"}], ",", 
         RowBox[{"mc", "=", 
          RowBox[{"nm", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", 
       RowBox[{"res", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"nm", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"vc", "+", "mc"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{
        RowBox[{"res", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", "mc"}]}], "]"}], "]"}], "=", "mat"}], ";", 
       RowBox[{
        RowBox[{"res", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{
            RowBox[{"mc", "+", "1"}], ";;"}]}], "]"}], "]"}], "=", "vec"}], 
       ";", "res"}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.8374207286881747`*^9, 3.8374207425159836`*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"21b2f28b-aff9-4f97-bfb1-32a9f3d24a87"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SumList", "[", "a_List", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"b", "=", "a"}], ",", 
       RowBox[{"ia", "=", 
        RowBox[{"a", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ia", "+=", 
          RowBox[{"a", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"b", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", "ia"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", 
          RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}], ";", "b"}]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.779262447643319*^9, 3.779262588570649*^9}},
 CellLabel->
  "In[108]:=",ExpressionUUID->"d64ffe77-0954-4db5-b4ab-685fa26dca23"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1920, 997},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 205, 3, 67, "Chapter",ExpressionUUID->"83a0cf8f-d3ae-44c8-b40c-63f4dc270e55"],
Cell[788, 27, 361, 9, 78, "Text",ExpressionUUID->"40603b02-9f00-4e1a-b342-3924dd25f3f7"],
Cell[1152, 38, 619, 12, 100, "Text",ExpressionUUID->"73195803-8268-43f2-a405-969ddc712ef7"],
Cell[CellGroupData[{
Cell[1796, 54, 246, 4, 67, "Section",ExpressionUUID->"aeaffa70-f8d8-408f-8d39-8d415fe69e29"],
Cell[2045, 60, 7100, 177, 371, "Input",ExpressionUUID->"ac190018-15b7-4e96-bd1f-1893f94cfc89"],
Cell[9148, 239, 8596, 221, 428, "Input",ExpressionUUID->"dc997cd0-cad7-4b32-ae2f-d1b48b8402d7"],
Cell[17747, 462, 48607, 1296, 2119, "Input",ExpressionUUID->"6d2de892-2e8b-4deb-a374-f2f3c3f08881"],
Cell[66357, 1760, 3252, 86, 162, "Input",ExpressionUUID->"062bb2f2-12f9-46e8-ba4e-e1deca1f3398"],
Cell[69612, 1848, 9616, 263, 428, "Input",ExpressionUUID->"44c55d01-48d4-4408-839b-c740830bcd9a"],
Cell[79231, 2113, 2558, 67, 124, "Input",ExpressionUUID->"8b7c0f1d-efbd-434a-bbd7-1d4323cc6c7d"],
Cell[81792, 2182, 1000, 27, 48, "Input",ExpressionUUID->"e887727e-cda6-40fc-a299-0b6451139219"],
Cell[82795, 2211, 17184, 447, 846, "Input",ExpressionUUID->"b1a6705e-7d61-4be8-b455-f971b3c1f307"],
Cell[99982, 2660, 2885, 85, 105, "Input",ExpressionUUID->"d26d5d72-0b86-4864-9123-14f4e79d04bb"],
Cell[CellGroupData[{
Cell[102892, 2749, 231, 6, 44, "Subsubsection",ExpressionUUID->"b8c93c79-1b68-4bc4-96ad-4effa00a0704"],
Cell[103126, 2757, 6310, 160, 276, "Input",ExpressionUUID->"7e312687-7d02-46d8-8efd-d220cac82664"],
Cell[109439, 2919, 16714, 447, 637, "Input",ExpressionUUID->"e0cd63e4-8345-4f4e-9443-57f10737291d"],
Cell[126156, 3368, 2572, 70, 124, "Input",ExpressionUUID->"af4243db-2fe4-455e-8588-abea6568ed0e"],
Cell[128731, 3440, 5573, 139, 238, "Input",ExpressionUUID->"912f7897-bab0-4cd2-bd8f-6eaa4185199d"],
Cell[134307, 3581, 2905, 80, 86, "Input",ExpressionUUID->"c4aebb53-7f7e-40a8-ae3a-81b783d030d7"],
Cell[137215, 3663, 3111, 83, 86, "Input",ExpressionUUID->"f4f27d16-93da-4775-a382-d07a7db13f5e"],
Cell[140329, 3748, 660, 18, 28, "Input",ExpressionUUID->"a5f9156a-3515-4bb4-bfa5-9b44400727bb"],
Cell[140992, 3768, 17938, 478, 770, "Input",ExpressionUUID->"d7a3a8f6-2538-48dc-81e4-95405381f418"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[158979, 4252, 190, 3, 67, "Section",ExpressionUUID->"f915bbee-d71b-4b1e-b884-78c387c96393"],
Cell[159172, 4257, 342, 6, 34, "Text",ExpressionUUID->"10dd2d65-e7c2-4b9c-a1f9-dd231c5c1ce3"],
Cell[159517, 4265, 2085, 56, 143, "Input",ExpressionUUID->"c07596a4-50c9-42b4-93b2-78411a2b5639"],
Cell[161605, 4323, 12025, 292, 390, "Input",ExpressionUUID->"aa2d0b77-8534-4cbb-af29-bd5c45b4f2d3"],
Cell[173633, 4617, 145, 2, 28, "Input",ExpressionUUID->"7451df64-a3cc-4281-adaa-4ee03f2ecc31"],
Cell[173781, 4621, 61949, 1498, 2043, "Input",ExpressionUUID->"3c2174e2-cef8-433d-862e-c5db472794a2"],
Cell[235733, 6121, 44761, 1065, 1587, "Input",ExpressionUUID->"6a26dbca-3eaa-44f4-b364-e60f0984ca9d"],
Cell[280497, 7188, 14078, 354, 675, "Input",ExpressionUUID->"f13e3270-d0a1-4910-ab11-7f6654e9c68d"],
Cell[294578, 7544, 14902, 388, 618, "Input",ExpressionUUID->"127bbe67-8325-4891-9cd8-d33b209d1c47"],
Cell[309483, 7934, 5548, 145, 257, "Input",ExpressionUUID->"f7712f3b-5a7c-4da8-b7fb-02fa52209e7b"],
Cell[315034, 8081, 7803, 217, 257, "Input",ExpressionUUID->"2358f125-8d86-43bf-a779-8f3dc25979eb"],
Cell[322840, 8300, 1208, 39, 48, "Input",ExpressionUUID->"33b9b803-735b-49e4-9ad7-27212ead0651"],
Cell[324051, 8341, 3725, 108, 124, "Input",ExpressionUUID->"312f426b-2b9c-40f9-9100-f8b87f1b4699"],
Cell[327779, 8451, 2563, 71, 200, "Input",ExpressionUUID->"21b2f28b-aff9-4f97-bfb1-32a9f3d24a87"],
Cell[330345, 8524, 924, 28, 28, "Input",ExpressionUUID->"d64ffe77-0954-4db5-b4ab-685fa26dca23"]
}, Open  ]]
}, Open  ]]
}
]
*)

